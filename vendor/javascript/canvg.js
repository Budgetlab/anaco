// canvg@4.0.2 downloaded from https://ga.jspm.io/npm:canvg@4.0.2/dist/index.js

import t from"raf";import e from"rgbcolor";import{SVGPathData as s}from"svg-pathdata";import{canvasRGBA as n}from"stackblur-canvas";
/**
 * Options preset for `OffscreenCanvas`.
 * @param config - Preset requirements.
 * @param config.DOMParser - XML/HTML parser from string into DOM Document.
 * @returns Preset object.
 */function offscreen(){let{DOMParser:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={window:null,ignoreAnimation:true,ignoreMouse:true,DOMParser:t,createCanvas(t,e){return new OffscreenCanvas(t,e)},async createImage(t){const e=await fetch(t);const s=await e.blob();const n=await createImageBitmap(s);return n}};typeof globalThis.DOMParser==="undefined"&&typeof t!=="undefined"||Reflect.deleteProperty(e,"DOMParser");return e}
/**
 * Options preset for `node-canvas`.
 * @param config - Preset requirements.
 * @param config.DOMParser - XML/HTML parser from string into DOM Document.
 * @param config.canvas - `node-canvas` exports.
 * @param config.fetch - WHATWG-compatible `fetch` function.
 * @returns Preset object.
 */function node(t){let{DOMParser:e,canvas:s,fetch:n}=t;return{window:null,ignoreAnimation:true,ignoreMouse:true,DOMParser:e,fetch:n,createCanvas:s.createCanvas,createImage:s.loadImage}}var i=Object.freeze({__proto__:null,offscreen:offscreen,node:node});
/**
 * HTML-safe compress white-spaces.
 * @param str - String to compress.
 * @returns String.
 */function compressSpaces(t){return t.replace(/(?!\u3000)\s+/gm," ")}
/**
 * HTML-safe left trim.
 * @param str - String to trim.
 * @returns String.
 */function trimLeft(t){return t.replace(/^[\n \t]+/,"")}
/**
 * HTML-safe right trim.
 * @param str - String to trim.
 * @returns String.
 */function trimRight(t){return t.replace(/[\n \t]+$/,"")}
/**
 * String to numbers array.
 * @param str - Numbers string.
 * @returns Numbers array.
 */function toNumbers(t){const e=t.match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm);return e?e.map(parseFloat):[]}
/**
 * String to matrix value.
 * @param str - Numbers string.
 * @returns Matrix value.
 */function toMatrixValue(t){const e=toNumbers(t);const s=[e[0]||0,e[1]||0,e[2]||0,e[3]||0,e[4]||0,e[5]||0];return s}const r=/^[A-Z-]+$/;
/**
 * Normalize attribute name.
 * @param name - Attribute name.
 * @returns Normalized attribute name.
 */function normalizeAttributeName(t){return r.test(t)?t.toLowerCase():t}
/**
 * Parse external URL.
 * @param url - CSS url string.
 * @returns Parsed URL.
 */function parseExternalUrl(t){const e=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/.exec(t);return e&&(e[2]||e[3]||e[4])||""}
/**
 * Transform floats to integers in rgb colors.
 * @param color - Color to normalize.
 * @returns Normalized color.
 */function normalizeColor(t){if(!t.startsWith("rgb"))return t;let e=3;const s=t.replace(/\d+(\.\d+)?/g,((t,s)=>e--&&s?String(Math.round(parseFloat(t))):t));return s}const o=/(\[[^\]]+\])/g;const a=/(#[^\s+>~.[:]+)/g;const h=/(\.[^\s+>~.[:]+)/g;const l=/(::[^\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi;const u=/(:[\w-]+\([^)]*\))/gi;const g=/(:[^\s+>~.[:]+)/g;const d=/([^\s+>~.[:]+)/g;function findSelectorMatch(t,e){const s=e.exec(t);return s?[t.replace(e," "),s.length]:[t,0]}
/**
 * Measure selector specificity.
 * @param selector - Selector to measure.
 * @returns Specificity.
 */function getSelectorSpecificity(t){const e=[0,0,0];let s=t.replace(/:not\(([^)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," ");let n=0;[s,n]=findSelectorMatch(s,o);e[1]+=n;[s,n]=findSelectorMatch(s,a);e[0]+=n;[s,n]=findSelectorMatch(s,h);e[1]+=n;[s,n]=findSelectorMatch(s,l);e[2]+=n;[s,n]=findSelectorMatch(s,u);e[1]+=n;[s,n]=findSelectorMatch(s,g);e[1]+=n;s=s.replace(/[*\s+>~]/g," ").replace(/[#.]/g," ");[s,n]=findSelectorMatch(s,d);e[2]+=n;return e.join("")}const p=1e-8;
/**
 * Vector magnitude.
 * @param v
 * @returns Number result.
 */function vectorMagnitude(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))}
/**
 * Ratio between two vectors.
 * @param u
 * @param v
 * @returns Number result.
 */function vectorsRatio(t,e){return(t[0]*e[0]+t[1]*e[1])/(vectorMagnitude(t)*vectorMagnitude(e))}
/**
 * Angle between two vectors.
 * @param u
 * @param v
 * @returns Number result.
 */function vectorsAngle(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(vectorsRatio(t,e))}function CB1(t){return t*t*t}function CB2(t){return 3*t*t*(1-t)}function CB3(t){return 3*t*(1-t)*(1-t)}function CB4(t){return(1-t)*(1-t)*(1-t)}function QB1(t){return t*t}function QB2(t){return 2*t*(1-t)}function QB3(t){return(1-t)*(1-t)}class Property{static empty(t){return new Property(t,"EMPTY","")}split(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:" ";const{document:e,name:s}=this;return compressSpaces(this.getString()).trim().split(t).map((t=>new Property(e,s,t)))}hasValue(t){const e=this.value;return e!==null&&e!==""&&(t||e!==0)&&typeof e!=="undefined"}isString(t){const{value:e}=this;const s=typeof e==="string";return s&&t?t.test(e):s}isUrlDefinition(){return this.isString(/^url\(/)}isPixels(){if(!this.hasValue())return false;const t=this.getString();switch(true){case t.endsWith("px"):case/^[0-9]+$/.test(t):return true;default:return false}}setValue(t){this.value=t;return this}getValue(t){return typeof t==="undefined"||this.hasValue()?this.value:t}getNumber(t){if(!this.hasValue())return typeof t==="undefined"?0:parseFloat(t);const{value:e}=this;let s=parseFloat(e);this.isString(/%$/)&&(s/=100);return s}getString(t){return typeof t==="undefined"||this.hasValue()?typeof this.value==="undefined"?"":String(this.value):String(t)}getColor(t){let e=this.getString(t);if(this.isNormalizedColor)return e;this.isNormalizedColor=true;e=normalizeColor(e);this.value=e;return e}getDpi(){return 96}getRem(){return this.document.rootEmSize}getEm(){return this.document.emSize}getUnits(){return this.getString().replace(/[0-9.-]/g,"")}getPixels(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.hasValue())return 0;const[s,n]=typeof t==="boolean"?[void 0,t]:[t];const{viewPort:i}=this.document.screen;switch(true){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(i.computeSize("x"),i.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(i.computeSize("x"),i.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*i.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*i.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return this.getNumber()*15;case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case this.isString(/%$/)&&n:return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*i.computeSize(s);default:{const t=this.getNumber();return e&&t<1?t*i.computeSize(s):t}}}getMilliseconds(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():this.getNumber()*1e3:0}getRadians(){if(!this.hasValue())return 0;switch(true){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}getDefinition(){const t=this.getString();const e=/#([^)'"]+)/.exec(t);const s=(e===null||e===void 0?void 0:e[1])||t;return this.document.definitions[s]}getFillStyleDefinition(t,e){let s=this.getDefinition();if(!s)return null;if(typeof s.createGradient==="function"&&"getBoundingBox"in t)return s.createGradient(this.document.ctx,t,e);if(typeof s.createPattern==="function"){if(s.getHrefAttribute().hasValue()){const t=s.getAttribute("patternTransform");s=s.getHrefAttribute().getDefinition();s&&t.hasValue()&&s.getAttribute("patternTransform",true).setValue(t.value)}if(s)return s.createPattern(this.document.ctx,t,e)}return null}getTextBaseline(){if(!this.hasValue())return null;const t=this.getString();return Property.textBaselineMapping[t]||null}addOpacity(t){let s=this.getColor();const n=s.length;let i=0;for(let t=0;t<n;t++){s[t]===","&&i++;if(i===3)break}if(t.hasValue()&&this.isString()&&i!==3){const n=new e(s);if(n.ok){n.alpha=t.getNumber();s=n.toRGBA()}}return new Property(this.document,this.name,s)}constructor(t,e,s){this.document=t;this.name=e;this.value=s;this.isNormalizedColor=false}}Property.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};class ViewPort{clear(){this.viewPorts=[]}setCurrent(t,e){this.viewPorts.push({width:t,height:e})}removeCurrent(){this.viewPorts.pop()}getRoot(){const[t]=this.viewPorts;return t||getDefault()}getCurrent(){const{viewPorts:t}=this;const e=t[t.length-1];return e||getDefault()}get width(){return this.getCurrent().width}get height(){return this.getCurrent().height}computeSize(t){return typeof t==="number"?t:t==="x"?this.width:t==="y"?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}constructor(){this.viewPorts=[]}}ViewPort.DEFAULT_VIEWPORT_WIDTH=800;ViewPort.DEFAULT_VIEWPORT_HEIGHT=600;function getDefault(){return{width:ViewPort.DEFAULT_VIEWPORT_WIDTH,height:ViewPort.DEFAULT_VIEWPORT_HEIGHT}}class Point{static parse(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const[s=e,n=e]=toNumbers(t);return new Point(s,n)}static parseScale(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const[s=e,n=s]=toNumbers(t);return new Point(s,n)}static parsePath(t){const e=toNumbers(t);const s=e.length;const n=[];for(let t=0;t<s;t+=2)n.push(new Point(e[t],e[t+1]));return n}angleTo(t){return Math.atan2(t.y-this.y,t.x-this.x)}applyTransform(t){const{x:e,y:s}=this;const n=e*t[0]+s*t[2]+t[4];const i=e*t[1]+s*t[3]+t[5];this.x=n;this.y=i}constructor(t,e){this.x=t;this.y=e}}class Mouse{isWorking(){return this.working}start(){if(this.working)return;const{screen:t,onClick:e,onMouseMove:s}=this;const n=t.ctx.canvas;n.onclick=e;n.onmousemove=s;this.working=true}stop(){if(!this.working)return;const t=this.screen.ctx.canvas;this.working=false;t.onclick=null;t.onmousemove=null}hasEvents(){return this.working&&this.events.length>0}runEvents(){if(!this.working)return;const{screen:t,events:e,eventElements:s}=this;const{style:n}=t.ctx.canvas;let i;n&&(n.cursor="");e.forEach(((t,e)=>{let{run:n}=t;i=s[e];while(i){n(i);i=i.parent}}));this.events=[];this.eventElements=[]}checkPath(t,e){if(!this.working||!e)return;const{events:s,eventElements:n}=this;s.forEach(((s,i)=>{let{x:r,y:o}=s;!n[i]&&e.isPointInPath&&e.isPointInPath(r,o)&&(n[i]=t)}))}checkBoundingBox(t,e){if(!this.working||!e)return;const{events:s,eventElements:n}=this;s.forEach(((s,i)=>{let{x:r,y:o}=s;!n[i]&&e.isPointInBox(r,o)&&(n[i]=t)}))}mapXY(t,e){const{window:s,ctx:n}=this.screen;const i=new Point(t,e);let r=n.canvas;while(r){i.x-=r.offsetLeft;i.y-=r.offsetTop;r=r.offsetParent}(s===null||s===void 0?void 0:s.scrollX)&&(i.x+=s.scrollX);(s===null||s===void 0?void 0:s.scrollY)&&(i.y+=s.scrollY);return i}onClick(t){const{x:e,y:s}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onclick",x:e,y:s,run(t){t.onClick&&t.onClick()}})}onMouseMove(t){const{x:e,y:s}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onmousemove",x:e,y:s,run(t){t.onMouseMove&&t.onMouseMove()}})}constructor(t){this.screen=t;this.working=false;this.events=[];this.eventElements=[];this.onClick=this.onClick.bind(this);this.onMouseMove=this.onMouseMove.bind(this)}}const f=typeof window!=="undefined"?window:null;const y=typeof fetch!=="undefined"?fetch.bind(void 0):void 0;class Screen{wait(t){this.waits.push(t)}ready(){return this.readyPromise?this.readyPromise:Promise.resolve()}isReady(){if(this.isReadyLock)return true;const t=this.waits.every((t=>t()));if(t){this.waits=[];this.resolveReady&&this.resolveReady()}this.isReadyLock=t;return t}setDefaults(t){t.strokeStyle="rgba(0,0,0,0)";t.lineCap="butt";t.lineJoin="miter";t.miterLimit=4}setViewBox(t){let{document:e,ctx:s,aspectRatio:n,width:i,desiredWidth:r,height:o,desiredHeight:a,minX:h=0,minY:l=0,refX:u,refY:g,clip:d=false,clipX:p=0,clipY:f=0}=t;const y=compressSpaces(n).replace(/^defer\s/,"");const[x,P]=y.split(" ");const b=x||"xMidYMid";const S=P||"meet";const E=i/r;const w=o/a;const v=Math.min(E,w);const A=Math.max(E,w);let C=r;let T=a;if(S==="meet"){C*=v;T*=v}if(S==="slice"){C*=A;T*=A}const V=new Property(e,"refX",u);const M=new Property(e,"refY",g);const k=V.hasValue()&&M.hasValue();k&&s.translate(-v*V.getPixels("x"),-v*M.getPixels("y"));if(d){const t=v*p;const e=v*f;s.beginPath();s.moveTo(t,e);s.lineTo(i,e);s.lineTo(i,o);s.lineTo(t,o);s.closePath();s.clip()}if(!k){const t=S==="meet"&&v===w;const e=S==="slice"&&A===w;const n=S==="meet"&&v===E;const r=S==="slice"&&A===E;b.startsWith("xMid")&&(t||e)&&s.translate(i/2-C/2,0);b.endsWith("YMid")&&(n||r)&&s.translate(0,o/2-T/2);b.startsWith("xMax")&&(t||e)&&s.translate(i-C,0);b.endsWith("YMax")&&(n||r)&&s.translate(0,o-T)}switch(true){case b==="none":s.scale(E,w);break;case S==="meet":s.scale(v,v);break;case S==="slice":s.scale(A,A);break}s.translate(-h,-l)}start(e){let{enableRedraw:s=false,ignoreMouse:n=false,ignoreAnimation:i=false,ignoreDimensions:r=false,ignoreClear:o=false,forceRedraw:a,scaleWidth:h,scaleHeight:l,offsetX:u,offsetY:g}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{mouse:d}=this;const p=1e3/Screen.FRAMERATE;this.isReadyLock=false;this.frameDuration=p;this.readyPromise=new Promise((t=>{this.resolveReady=t}));this.isReady()&&this.render(e,r,o,h,l,u,g);if(!s)return;let f=Date.now();let y=f;let x=0;const tick=()=>{f=Date.now();x=f-y;if(x>=p){y=f-x%p;if(this.shouldUpdate(i,a)){this.render(e,r,o,h,l,u,g);d.runEvents()}}this.intervalId=t(tick)};n||d.start();this.intervalId=t(tick)}stop(){if(this.intervalId){t.cancel(this.intervalId);this.intervalId=null}this.mouse.stop()}shouldUpdate(t,e){if(!t){const{frameDuration:t}=this;const e=this.animations.reduce(((e,s)=>s.update(t)||e),false);if(e)return true}return!(typeof e!=="function"||!e())||(!(this.isReadyLock||!this.isReady())||!!this.mouse.hasEvents())}render(t,e,s,n,i,r,o){const{viewPort:a,ctx:h,isFirstRender:l}=this;const u=h.canvas;a.clear();u.width&&u.height&&a.setCurrent(u.width,u.height);const g=t.getStyle("width");const d=t.getStyle("height");if(!e&&(l||typeof n!=="number"&&typeof i!=="number")){if(g.hasValue()){u.width=g.getPixels("x");u.style&&(u.style.width="".concat(u.width,"px"))}if(d.hasValue()){u.height=d.getPixels("y");u.style&&(u.style.height="".concat(u.height,"px"))}}let p=u.clientWidth||u.width;let f=u.clientHeight||u.height;if(e&&g.hasValue()&&d.hasValue()){p=g.getPixels("x");f=d.getPixels("y")}a.setCurrent(p,f);typeof r==="number"&&t.getAttribute("x",true).setValue(r);typeof o==="number"&&t.getAttribute("y",true).setValue(o);if(typeof n==="number"||typeof i==="number"){const e=toNumbers(t.getAttribute("viewBox").getString());let s=0;let r=0;if(typeof n==="number"){const i=t.getStyle("width");i.hasValue()?s=i.getPixels("x")/n:e[2]&&!isNaN(e[2])&&(s=e[2]/n)}if(typeof i==="number"){const s=t.getStyle("height");s.hasValue()?r=s.getPixels("y")/i:e[3]&&!isNaN(e[3])&&(r=e[3]/i)}s||(s=r);r||(r=s);t.getAttribute("width",true).setValue(n);t.getAttribute("height",true).setValue(i);const o=t.getStyle("transform",true,true);o.setValue("".concat(o.getString()," scale(").concat(1/s,", ").concat(1/r,")"))}s||h.clearRect(0,0,p,f);t.render(h);l&&(this.isFirstRender=false)}constructor(t,{fetch:e=y,window:s=f}={}){this.ctx=t;this.viewPort=new ViewPort;this.mouse=new Mouse(this);this.animations=[];this.waits=[];this.frameDuration=0;this.isReadyLock=false;this.isFirstRender=true;this.intervalId=null;this.window=s;if(!e)throw new Error("Can't find 'fetch' in 'globalThis', please provide it via options");this.fetch=e}}Screen.defaultWindow=f;Screen.defaultFetch=y;Screen.FRAMERATE=30;Screen.MAX_VIRTUAL_PIXELS=3e4;const{defaultFetch:x}=Screen;const P=typeof DOMParser!=="undefined"?DOMParser:void 0;class Parser{async parse(t){return t.startsWith("<")?this.parseFromString(t):this.load(t)}parseFromString(t){const e=new this.DOMParser;try{return this.checkDocument(e.parseFromString(t,"image/svg+xml"))}catch(s){return this.checkDocument(e.parseFromString(t,"text/xml"))}}checkDocument(t){const e=t.getElementsByTagName("parsererror")[0];if(e)throw new Error(e.textContent||"Unknown parse error");return t}async load(t){const e=await this.fetch(t);const s=await e.text();return this.parseFromString(s)}constructor({fetch:t=x,DOMParser:e=P}={}){if(!t)throw new Error("Can't find 'fetch' in 'globalThis', please provide it via options");if(!e)throw new Error("Can't find 'DOMParser' in 'globalThis', please provide it via options");this.fetch=t;this.DOMParser=e}}class Translate{apply(t){const{x:e,y:s}=this.point;t.translate(e||0,s||0)}unapply(t){const{x:e,y:s}=this.point;t.translate(-1*e||0,-1*s||0)}applyToPoint(t){const{x:e,y:s}=this.point;t.applyTransform([1,0,0,1,e||0,s||0])}constructor(t,e){this.type="translate";this.point=Point.parse(e)}}class Rotate{apply(t){const{cx:e,cy:s,originX:n,originY:i,angle:r}=this;const o=e+n.getPixels("x");const a=s+i.getPixels("y");t.translate(o,a);t.rotate(r.getRadians());t.translate(-o,-a)}unapply(t){const{cx:e,cy:s,originX:n,originY:i,angle:r}=this;const o=e+n.getPixels("x");const a=s+i.getPixels("y");t.translate(o,a);t.rotate(-1*r.getRadians());t.translate(-o,-a)}applyToPoint(t){const{cx:e,cy:s,angle:n}=this;const i=n.getRadians();t.applyTransform([1,0,0,1,e||0,s||0]);t.applyTransform([Math.cos(i),Math.sin(i),-Math.sin(i),Math.cos(i),0,0]);t.applyTransform([1,0,0,1,-e||0,-s||0])}constructor(t,e,s){this.type="rotate";const n=toNumbers(e);this.angle=new Property(t,"angle",n[0]);this.originX=s[0];this.originY=s[1];this.cx=n[1]||0;this.cy=n[2]||0}}class Scale{apply(t){const{scale:{x:e,y:s},originX:n,originY:i}=this;const r=n.getPixels("x");const o=i.getPixels("y");t.translate(r,o);t.scale(e,s||e);t.translate(-r,-o)}unapply(t){const{scale:{x:e,y:s},originX:n,originY:i}=this;const r=n.getPixels("x");const o=i.getPixels("y");t.translate(r,o);t.scale(1/e,1/s||e);t.translate(-r,-o)}applyToPoint(t){const{x:e,y:s}=this.scale;t.applyTransform([e||0,0,0,s||0,0,0])}constructor(t,e,s){this.type="scale";const n=Point.parseScale(e);if(n.x===0||n.y===0){n.x=p;n.y=p}this.scale=n;this.originX=s[0];this.originY=s[1]}}class Matrix{apply(t){const{originX:e,originY:s,matrix:n}=this;const i=e.getPixels("x");const r=s.getPixels("y");t.translate(i,r);t.transform(n[0],n[1],n[2],n[3],n[4],n[5]);t.translate(-i,-r)}unapply(t){const{originX:e,originY:s,matrix:n}=this;const i=n[0];const r=n[2];const o=n[4];const a=n[1];const h=n[3];const l=n[5];const u=0;const g=0;const d=1;const p=1/(i*(h*d-l*g)-r*(a*d-l*u)+o*(a*g-h*u));const f=e.getPixels("x");const y=s.getPixels("y");t.translate(f,y);t.transform(p*(h*d-l*g),p*(l*u-a*d),p*(o*g-r*d),p*(i*d-o*u),p*(r*l-o*h),p*(o*a-i*l));t.translate(-f,-y)}applyToPoint(t){t.applyTransform(this.matrix)}constructor(t,e,s){this.type="matrix";this.matrix=toMatrixValue(e);this.originX=s[0];this.originY=s[1]}}class Skew extends Matrix{constructor(t,e,s){super(t,e,s);this.type="skew";this.angle=new Property(t,"angle",e)}}class SkewX extends Skew{constructor(t,e,s){super(t,e,s);this.type="skewX";this.matrix=[1,0,Math.tan(this.angle.getRadians()),1,0,0]}}class SkewY extends Skew{constructor(t,e,s){super(t,e,s);this.type="skewY";this.matrix=[1,Math.tan(this.angle.getRadians()),0,1,0,0]}}function parseTransforms(t){return compressSpaces(t).trim().replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)}function parseTransform(t){const[e="",s=""]=t.split("(");return[e.trim(),s.trim().replace(")","")]}class Transform{static fromElement(t,e){const s=e.getStyle("transform",false,true);if(s.hasValue()){const[n,i=n]=e.getStyle("transform-origin",false,true).split();if(n&&i){const e=[n,i];return new Transform(t,s.getString(),e)}}return null}apply(t){this.transforms.forEach((e=>e.apply(t)))}unapply(t){this.transforms.forEach((e=>e.unapply(t)))}applyToPoint(t){this.transforms.forEach((e=>e.applyToPoint(t)))}constructor(t,e,s){this.document=t;this.transforms=[];const n=parseTransforms(e);n.forEach((t=>{if(t==="none")return;const[e,n]=parseTransform(t);const i=Transform.transformTypes[e];i&&this.transforms.push(new i(this.document,n,s))}))}}Transform.transformTypes={translate:Translate,rotate:Rotate,scale:Scale,matrix:Matrix,skewX:SkewX,skewY:SkewY};class Element{getAttribute(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=this.attributes[t];if(!s&&e){const e=new Property(this.document,t,"");this.attributes[t]=e;return e}return s||Property.empty(this.document)}getHrefAttribute(){let t;for(const e in this.attributes)if(e==="href"||e.endsWith(":href")){t=this.attributes[e];break}return t||Property.empty(this.document)}getStyle(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const n=this.styles[t];if(n)return n;const i=this.getAttribute(t);if(i.hasValue()){this.styles[t]=i;return i}if(!s){const{parent:e}=this;if(e){const s=e.getStyle(t);if(s.hasValue())return s}}if(e){const e=new Property(this.document,t,"");this.styles[t]=e;return e}return Property.empty(this.document)}render(t){if(this.getStyle("display").getString()!=="none"&&this.getStyle("visibility").getString()!=="hidden"){t.save();if(this.getStyle("mask").hasValue()){const e=this.getStyle("mask").getDefinition();if(e){this.applyEffects(t);e.apply(t,this)}}else if(this.getStyle("filter").getValue("none")!=="none"){const e=this.getStyle("filter").getDefinition();if(e){this.applyEffects(t);e.apply(t,this)}}else{this.setContext(t);this.renderChildren(t);this.clearContext(t)}t.restore()}}setContext(t){}applyEffects(t){const e=Transform.fromElement(this.document,this);e&&e.apply(t);const s=this.getStyle("clip-path",false,true);if(s.hasValue()){const e=s.getDefinition();e&&e.apply(t)}}clearContext(t){}renderChildren(t){this.children.forEach((e=>{e.render(t)}))}addChild(t){const e=t instanceof Element?t:this.document.createElement(t);e.parent=this;Element.ignoreChildTypes.includes(e.type)||this.children.push(e)}matchesSelector(t){var e;const{node:s}=this;if(typeof s.matches==="function")return s.matches(t);const n=(e=s.getAttribute)===null||e===void 0?void 0:e.call(s,"class");return!(!n||n==="")&&n.split(" ").some((e=>".".concat(e)===t))}addStylesFromStyleDefinition(){const{styles:t,stylesSpecificity:e}=this.document;let s;for(const n in t)if(!n.startsWith("@")&&this.matchesSelector(n)){const i=t[n];const r=e[n];if(i)for(const t in i){let e=this.stylesSpecificity[t];typeof e==="undefined"&&(e="000");if(r&&r>=e){s=i[t];s&&(this.styles[t]=s);this.stylesSpecificity[t]=r}}}}removeStyles(t,e){const s=e.reduce(((e,s)=>{const n=t.getStyle(s);if(!n.hasValue())return e;const i=n.getString();n.setValue("");return[...e,[s,i]]}),[]);return s}restoreStyles(t,e){e.forEach((e=>{let[s,n]=e;t.getStyle(s,true).setValue(n)}))}isFirstChild(){var t;return((t=this.parent)===null||t===void 0?void 0:t.children.indexOf(this))===0}constructor(t,e,s=false){this.document=t;this.node=e;this.captureTextNodes=s;this.type="";this.attributes={};this.styles={};this.stylesSpecificity={};this.animationFrozen=false;this.animationFrozenValue="";this.parent=null;this.children=[];if(!e||e.nodeType!==1)return;Array.from(e.attributes).forEach((e=>{const s=normalizeAttributeName(e.nodeName);this.attributes[s]=new Property(t,s,e.value)}));this.addStylesFromStyleDefinition();if(this.getAttribute("style").hasValue()){const e=this.getAttribute("style").getString().split(";").map((t=>t.trim()));e.forEach((e=>{if(!e)return;const[s,n]=e.split(":").map((t=>t.trim()));s&&(this.styles[s]=new Property(t,s,n))}))}const{definitions:n}=t;const i=this.getAttribute("id");i.hasValue()&&(n[i.getString()]||(n[i.getString()]=this));Array.from(e.childNodes).forEach((e=>{if(e.nodeType===1)this.addChild(e);else if(s&&(e.nodeType===3||e.nodeType===4)){const s=t.createTextNode(e);s.getText().length>0&&this.addChild(s)}}))}}Element.ignoreChildTypes=["title"];class UnknownElement extends Element{constructor(t,e,s){super(t,e,s)}}function wrapFontFamily(t){const e=t.trim();return/^('|")/.test(e)?e:'"'.concat(e,'"')}function prepareFontFamily(t){return typeof process==="undefined"?t:t.trim().split(",").map(wrapFontFamily).join(",")}
/**
 * https://developer.mozilla.org/en-US/docs/Web/CSS/font-style
 * @param fontStyle
 * @returns CSS font style.
 */function prepareFontStyle(t){if(!t)return"";const e=t.trim().toLowerCase();switch(e){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return e;default:return/^oblique\s+(-|)\d+deg$/.test(e)?e:""}}
/**
 * https://developer.mozilla.org/en-US/docs/Web/CSS/font-weight
 * @param fontWeight
 * @returns CSS font weight.
 */function prepareFontWeight(t){if(!t)return"";const e=t.trim().toLowerCase();switch(e){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return e;default:return/^[\d.]+$/.test(e)?e:""}}class Font{static parse(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0;let s="";let n="";let i="";let r="";let o="";const a=compressSpaces(t).trim().split(" ");const h={fontSize:false,fontStyle:false,fontWeight:false,fontVariant:false};a.forEach((t=>{switch(true){case!h.fontStyle&&Font.styles.includes(t):t!=="inherit"&&(s=t);h.fontStyle=true;break;case!h.fontVariant&&Font.variants.includes(t):t!=="inherit"&&(n=t);h.fontStyle=true;h.fontVariant=true;break;case!h.fontWeight&&Font.weights.includes(t):t!=="inherit"&&(i=t);h.fontStyle=true;h.fontVariant=true;h.fontWeight=true;break;case!h.fontSize:t!=="inherit"&&(r=t.split("/")[0]||"");h.fontStyle=true;h.fontVariant=true;h.fontWeight=true;h.fontSize=true;break;default:t!=="inherit"&&(o+=t)}}));return new Font(s,n,i,r,o,e)}toString(){return[prepareFontStyle(this.fontStyle),this.fontVariant,prepareFontWeight(this.fontWeight),this.fontSize,prepareFontFamily(this.fontFamily)].join(" ").trim()}constructor(t,e,s,n,i,r){const o=r?typeof r==="string"?Font.parse(r):r:{};this.fontFamily=i||o.fontFamily;this.fontSize=n||o.fontSize;this.fontStyle=t||o.fontStyle;this.fontWeight=s||o.fontWeight;this.fontVariant=e||o.fontVariant}}Font.styles="normal|italic|oblique|inherit";Font.variants="normal|small-caps|inherit";Font.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";class BoundingBox{get x(){return this.x1}get y(){return this.y1}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}addPoint(t,e){if(typeof t!=="undefined"){if(isNaN(this.x1)||isNaN(this.x2)){this.x1=t;this.x2=t}t<this.x1&&(this.x1=t);t>this.x2&&(this.x2=t)}if(typeof e!=="undefined"){if(isNaN(this.y1)||isNaN(this.y2)){this.y1=e;this.y2=e}e<this.y1&&(this.y1=e);e>this.y2&&(this.y2=e)}}addX(t){this.addPoint(t,0)}addY(t){this.addPoint(0,t)}addBoundingBox(t){if(!t)return;const{x1:e,y1:s,x2:n,y2:i}=t;this.addPoint(e,s);this.addPoint(n,i)}sumCubic(t,e,s,n,i){return Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*s+3*(1-t)*Math.pow(t,2)*n+Math.pow(t,3)*i}bezierCurveAdd(t,e,s,n,i){const r=6*e-12*s+6*n;const o=-3*e+9*s-9*n+3*i;const a=3*s-3*e;if(o===0){if(r===0)return;const o=-a/r;0<o&&o<1&&(t?this.addX(this.sumCubic(o,e,s,n,i)):this.addY(this.sumCubic(o,e,s,n,i)));return}const h=Math.pow(r,2)-4*a*o;if(h<0)return;const l=(-r+Math.sqrt(h))/(2*o);0<l&&l<1&&(t?this.addX(this.sumCubic(l,e,s,n,i)):this.addY(this.sumCubic(l,e,s,n,i)));const u=(-r-Math.sqrt(h))/(2*o);0<u&&u<1&&(t?this.addX(this.sumCubic(u,e,s,n,i)):this.addY(this.sumCubic(u,e,s,n,i)))}addBezierCurve(t,e,s,n,i,r,o,a){this.addPoint(t,e);this.addPoint(o,a);this.bezierCurveAdd(true,t,s,i,o);this.bezierCurveAdd(false,e,n,r,a)}addQuadraticCurve(t,e,s,n,i,r){const o=t+2/3*(s-t);const a=e+2/3*(n-e);const h=o+1/3*(i-t);const l=a+1/3*(r-e);this.addBezierCurve(t,e,o,h,a,l,i,r)}isPointInBox(t,e){const{x1:s,y1:n,x2:i,y2:r}=this;return s<=t&&t<=i&&n<=e&&e<=r}constructor(t=Number.NaN,e=Number.NaN,s=Number.NaN,n=Number.NaN){this.x1=t;this.y1=e;this.x2=s;this.y2=n;this.addPoint(t,e);this.addPoint(s,n)}}class RenderedElement extends Element{calculateOpacity(){let t=1;let e=this;while(e){const s=e.getStyle("opacity",false,true);s.hasValue(true)&&(t*=s.getNumber());e=e.parent}return t}setContext(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!e){const e=this.getStyle("fill");const s=this.getStyle("fill-opacity");const n=this.getStyle("stroke");const i=this.getStyle("stroke-opacity");if(e.isUrlDefinition()){const n=e.getFillStyleDefinition(this,s);n&&(t.fillStyle=n)}else if(e.hasValue()){e.getString()==="currentColor"&&e.setValue(this.getStyle("color").getColor());const s=e.getColor();s!=="inherit"&&(t.fillStyle=s==="none"?"rgba(0,0,0,0)":s)}if(s.hasValue()){const e=new Property(this.document,"fill",t.fillStyle).addOpacity(s).getColor();t.fillStyle=e}if(n.isUrlDefinition()){const e=n.getFillStyleDefinition(this,i);e&&(t.strokeStyle=e)}else if(n.hasValue()){n.getString()==="currentColor"&&n.setValue(this.getStyle("color").getColor());const e=n.getString();e!=="inherit"&&(t.strokeStyle=e==="none"?"rgba(0,0,0,0)":e)}if(i.hasValue()){const e=new Property(this.document,"stroke",t.strokeStyle).addOpacity(i).getString();t.strokeStyle=e}const r=this.getStyle("stroke-width");if(r.hasValue()){const e=r.getPixels();t.lineWidth=e||p}const o=this.getStyle("stroke-linecap");const a=this.getStyle("stroke-linejoin");const h=this.getStyle("stroke-miterlimit");const l=this.getStyle("stroke-dasharray");const u=this.getStyle("stroke-dashoffset");o.hasValue()&&(t.lineCap=o.getString());a.hasValue()&&(t.lineJoin=a.getString());h.hasValue()&&(t.miterLimit=h.getNumber());if(l.hasValue()&&l.getString()!=="none"){const e=toNumbers(l.getString());typeof t.setLineDash!=="undefined"?t.setLineDash(e):typeof t.webkitLineDash!=="undefined"?t.webkitLineDash=e:typeof t.mozDash==="undefined"||e.length===1&&e[0]===0||(t.mozDash=e);const s=u.getPixels();typeof t.lineDashOffset!=="undefined"?t.lineDashOffset=s:typeof t.webkitLineDashOffset!=="undefined"?t.webkitLineDashOffset=s:typeof t.mozDashOffset!=="undefined"&&(t.mozDashOffset=s)}}this.modifiedEmSizeStack=false;if(typeof t.font!=="undefined"){const e=this.getStyle("font");const s=this.getStyle("font-style");const n=this.getStyle("font-variant");const i=this.getStyle("font-weight");const r=this.getStyle("font-size");const o=this.getStyle("font-family");const a=new Font(s.getString(),n.getString(),i.getString(),r.hasValue()?"".concat(r.getPixels(true),"px"):"",o.getString(),Font.parse(e.getString(),t.font));s.setValue(a.fontStyle);n.setValue(a.fontVariant);i.setValue(a.fontWeight);r.setValue(a.fontSize);o.setValue(a.fontFamily);t.font=a.toString();if(r.isPixels()){this.document.emSize=r.getPixels();this.modifiedEmSizeStack=true}}if(!e){this.applyEffects(t);t.globalAlpha=this.calculateOpacity()}}clearContext(t){super.clearContext(t);this.modifiedEmSizeStack&&this.document.popEmSize()}constructor(...t){super(...t);this.modifiedEmSizeStack=false}}class TextElement extends RenderedElement{setContext(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super.setContext(t,e);const s=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();s&&(t.textBaseline=s)}initializeCoordinates(){this.x=0;this.y=0;this.leafTexts=[];this.textChunkStart=0;this.minX=Number.POSITIVE_INFINITY;this.maxX=Number.NEGATIVE_INFINITY}getBoundingBox(t){if(this.type!=="text")return this.getTElementBoundingBox(t);this.initializeCoordinates();this.adjustChildCoordinatesRecursive(t);let e=null;this.children.forEach(((s,n)=>{const i=this.getChildBoundingBox(t,this,this,n);e?e.addBoundingBox(i):e=i}));return e}getFontSize(){const{document:t,parent:e}=this;const s=Font.parse(t.ctx.font).fontSize;const n=e.getStyle("font-size").getNumber(s);return n}getTElementBoundingBox(t){const e=this.getFontSize();return new BoundingBox(this.x,this.y-e,this.x+this.measureText(t),this.y)}getGlyph(t,e,s){const n=e[s];let i;if(t.isArabic){var r;const o=e.length;const a=e[s-1];const h=e[s+1];let l="isolated";(s===0||a===" ")&&s<o-1&&h!==" "&&(l="terminal");s>0&&a!==" "&&s<o-1&&h!==" "&&(l="medial");s>0&&a!==" "&&(s===o-1||h===" ")&&(l="initial");i=((r=t.arabicGlyphs[n])===null||r===void 0?void 0:r[l])||t.glyphs[n]}else i=t.glyphs[n];i||(i=t.missingGlyph);return i}getText(){return""}getTextFromNode(t){const e=t||this.node;const s=Array.from(e.parentNode.childNodes);const n=s.indexOf(e);const i=s.length-1;let r=compressSpaces(e.textContent||"");n===0&&(r=trimLeft(r));n===i&&(r=trimRight(r));return r}renderChildren(t){if(this.type!=="text"){this.renderTElementChildren(t);return}this.initializeCoordinates();this.adjustChildCoordinatesRecursive(t);this.children.forEach(((e,s)=>{this.renderChild(t,this,this,s)}));const{mouse:e}=this.document.screen;e.isWorking()&&e.checkBoundingBox(this,this.getBoundingBox(t))}renderTElementChildren(t){const{document:e,parent:s}=this;const n=this.getText();const i=s.getStyle("font-family").getDefinition();if(i){const{unitsPerEm:r}=i.fontFace;const o=Font.parse(e.ctx.font);const a=s.getStyle("font-size").getNumber(o.fontSize);const h=s.getStyle("font-style").getString(o.fontStyle);const l=a/r;const u=i.isRTL?n.split("").reverse().join(""):n;const g=toNumbers(s.getAttribute("dx").getString());const d=u.length;for(let e=0;e<d;e++){const s=this.getGlyph(i,u,e);t.translate(this.x,this.y);t.scale(l,-l);const n=t.lineWidth;t.lineWidth=t.lineWidth*r/a;h==="italic"&&t.transform(1,0,.4,1,0,0);s.render(t);h==="italic"&&t.transform(1,0,-.4,1,0,0);t.lineWidth=n;t.scale(1/l,-1/l);t.translate(-this.x,-this.y);this.x+=a*(s.horizAdvX||i.horizAdvX)/r;typeof g[e]==="undefined"||isNaN(g[e])||(this.x+=g[e])}return}const{x:r,y:o}=this;t.fillStyle&&t.fillText(n,r,o);t.strokeStyle&&t.strokeText(n,r,o)}applyAnchoring(){if(this.textChunkStart>=this.leafTexts.length)return;const t=this.leafTexts[this.textChunkStart];const e=t.getStyle("text-anchor").getString("start");const s=false;let n=0;n=e==="start"&&!s||e==="end"&&s?t.x-this.minX:e==="end"&&!s||e==="start"&&s?t.x-this.maxX:t.x-(this.minX+this.maxX)/2;for(let t=this.textChunkStart;t<this.leafTexts.length;t++)this.leafTexts[t].x+=n;this.minX=Number.POSITIVE_INFINITY;this.maxX=Number.NEGATIVE_INFINITY;this.textChunkStart=this.leafTexts.length}adjustChildCoordinatesRecursive(t){this.children.forEach(((e,s)=>{this.adjustChildCoordinatesRecursiveCore(t,this,this,s)}));this.applyAnchoring()}adjustChildCoordinatesRecursiveCore(t,e,s,n){const i=s.children[n];i.children.length>0?i.children.forEach(((s,n)=>{e.adjustChildCoordinatesRecursiveCore(t,e,i,n)})):this.adjustChildCoordinates(t,e,s,n)}adjustChildCoordinates(t,e,s,n){const i=s.children[n];if(typeof i.measureText!=="function")return i;t.save();i.setContext(t,true);const r=i.getAttribute("x");const o=i.getAttribute("y");const a=i.getAttribute("dx");const h=i.getAttribute("dy");const l=i.getStyle("font-family").getDefinition();const u=Boolean(l===null||l===void 0?void 0:l.isRTL);if(n===0){r.hasValue()||r.setValue(i.getInheritedAttribute("x"));o.hasValue()||o.setValue(i.getInheritedAttribute("y"));a.hasValue()||a.setValue(i.getInheritedAttribute("dx"));h.hasValue()||h.setValue(i.getInheritedAttribute("dy"))}const g=i.measureText(t);u&&(e.x-=g);if(r.hasValue()){e.applyAnchoring();i.x=r.getPixels("x");a.hasValue()&&(i.x+=a.getPixels("x"))}else{a.hasValue()&&(e.x+=a.getPixels("x"));i.x=e.x}e.x=i.x;u||(e.x+=g);if(o.hasValue()){i.y=o.getPixels("y");h.hasValue()&&(i.y+=h.getPixels("y"))}else{h.hasValue()&&(e.y+=h.getPixels("y"));i.y=e.y}e.y=i.y;e.leafTexts.push(i);e.minX=Math.min(e.minX,i.x,i.x+g);e.maxX=Math.max(e.maxX,i.x,i.x+g);i.clearContext(t);t.restore();return i}getChildBoundingBox(t,e,s,n){const i=s.children[n];if(typeof i.getBoundingBox!=="function")return null;const r=i.getBoundingBox(t);r&&i.children.forEach(((s,n)=>{const o=e.getChildBoundingBox(t,e,i,n);r.addBoundingBox(o)}));return r}renderChild(t,e,s,n){const i=s.children[n];i.render(t);i.children.forEach(((s,n)=>{e.renderChild(t,e,i,n)}))}measureText(t){const{measureCache:e}=this;if(~e)return e;const s=this.getText();const n=this.measureTargetText(t,s);this.measureCache=n;return n}measureTargetText(t,e){if(!e.length)return 0;const{parent:s}=this;const n=s.getStyle("font-family").getDefinition();if(n){const t=this.getFontSize();const i=n.isRTL?e.split("").reverse().join(""):e;const r=toNumbers(s.getAttribute("dx").getString());const o=i.length;let a=0;for(let e=0;e<o;e++){const s=this.getGlyph(n,i,e);a+=(s.horizAdvX||n.horizAdvX)*t/n.fontFace.unitsPerEm;typeof r[e]==="undefined"||isNaN(r[e])||(a+=r[e])}return a}if(!t.measureText)return e.length*10;t.save();this.setContext(t,true);const{width:i}=t.measureText(e);this.clearContext(t);t.restore();return i}
/**
   * Inherits positional attributes from {@link TextElement} parent(s). Attributes
   * are only inherited from a parent to its first child.
   * @param name - The attribute name.
   * @returns The attribute value or null.
   */getInheritedAttribute(t){let e=this;while(e instanceof TextElement&&e.isFirstChild()&&e.parent){const s=e.parent.getAttribute(t);if(s.hasValue(true))return s.getString("0");e=e.parent}return null}constructor(t,e,s){super(t,e,new.target===TextElement||s);this.type="text";this.x=0;this.y=0;this.leafTexts=[];this.textChunkStart=0;this.minX=Number.POSITIVE_INFINITY;this.maxX=Number.NEGATIVE_INFINITY;this.measureCache=-1}}class TSpanElement extends TextElement{getText(){return this.text}constructor(t,e,s){super(t,e,new.target===TSpanElement||s);this.type="tspan";this.text=this.children.length>0?"":this.getTextFromNode()}}class TextNode extends TSpanElement{constructor(...t){super(...t);this.type="textNode"}}class PathParser extends s{reset(){this.i=-1;this.command=null;this.previousCommand=null;this.start=new Point(0,0);this.control=new Point(0,0);this.current=new Point(0,0);this.points=[];this.angles=[]}isEnd(){const{i:t,commands:e}=this;return t>=e.length-1}next(){const t=this.commands[++this.i];this.previousCommand=this.command;this.command=t;return t}getPoint(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"x",e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"y";const s=new Point(this.command[t],this.command[e]);return this.makeAbsolute(s)}getAsControlPoint(t,e){const s=this.getPoint(t,e);this.control=s;return s}getAsCurrentPoint(t,e){const s=this.getPoint(t,e);this.current=s;return s}getReflectedControlPoint(){const t=this.previousCommand.type;if(t!==s.CURVE_TO&&t!==s.SMOOTH_CURVE_TO&&t!==s.QUAD_TO&&t!==s.SMOOTH_QUAD_TO)return this.current;const{current:{x:e,y:n},control:{x:i,y:r}}=this;const o=new Point(2*e-i,2*n-r);return o}makeAbsolute(t){if(this.command.relative){const{x:e,y:s}=this.current;t.x+=e;t.y+=s}return t}addMarker(t,e,s){const{points:n,angles:i}=this;s&&i.length>0&&!i[i.length-1]&&(i[i.length-1]=n[n.length-1].angleTo(s));this.addMarkerAngle(t,e?e.angleTo(t):null)}addMarkerAngle(t,e){this.points.push(t);this.angles.push(e)}getMarkerPoints(){return this.points}getMarkerAngles(){const{angles:t}=this;const e=t.length;for(let s=0;s<e;s++)if(!t[s])for(let n=s+1;n<e;n++)if(t[n]){t[s]=t[n];break}return t}constructor(t){super(t.replace(/([+\-.])\s+/gm,"$1").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,""));this.control=new Point(0,0);this.start=new Point(0,0);this.current=new Point(0,0);this.command=null;this.commands=this.commands;this.i=-1;this.previousCommand=null;this.points=[];this.angles=[]}}class PathElement extends RenderedElement{path(t){const{pathParser:e}=this;const s=new BoundingBox;e.reset();t&&t.beginPath();while(!e.isEnd())switch(e.next().type){case PathParser.MOVE_TO:this.pathM(t,s);break;case PathParser.LINE_TO:this.pathL(t,s);break;case PathParser.HORIZ_LINE_TO:this.pathH(t,s);break;case PathParser.VERT_LINE_TO:this.pathV(t,s);break;case PathParser.CURVE_TO:this.pathC(t,s);break;case PathParser.SMOOTH_CURVE_TO:this.pathS(t,s);break;case PathParser.QUAD_TO:this.pathQ(t,s);break;case PathParser.SMOOTH_QUAD_TO:this.pathT(t,s);break;case PathParser.ARC:this.pathA(t,s);break;case PathParser.CLOSE_PATH:this.pathZ(t,s);break}return s}getBoundingBox(t){return this.path()}getMarkers(){const{pathParser:t}=this;const e=t.getMarkerPoints();const s=t.getMarkerAngles();const n=e.map(((t,e)=>[t,s[e]]));return n}renderChildren(t){this.path(t);this.document.screen.mouse.checkPath(this,t);const e=this.getStyle("fill-rule");t.fillStyle!==""&&(e.getString("inherit")!=="inherit"?t.fill(e.getString()):t.fill());if(t.strokeStyle!=="")if(this.getAttribute("vector-effect").getString()==="non-scaling-stroke"){t.save();t.setTransform(1,0,0,1,0,0);t.stroke();t.restore()}else t.stroke();const s=this.getMarkers();if(s){const e=s.length-1;const n=this.getStyle("marker-start");const i=this.getStyle("marker-mid");const r=this.getStyle("marker-end");if(n.isUrlDefinition()){const e=n.getDefinition();const[i,r]=s[0];e.render(t,i,r)}if(i.isUrlDefinition()){const n=i.getDefinition();for(let i=1;i<e;i++){const[e,r]=s[i];n.render(t,e,r)}}if(r.isUrlDefinition()){const n=r.getDefinition();const[i,o]=s[e];n.render(t,i,o)}}}static pathM(t){const e=t.getAsCurrentPoint();t.start=t.current;return{point:e}}pathM(t,e){const{pathParser:s}=this;const{point:n}=PathElement.pathM(s);const{x:i,y:r}=n;s.addMarker(n);e.addPoint(i,r);t&&t.moveTo(i,r)}static pathL(t){const{current:e}=t;const s=t.getAsCurrentPoint();return{current:e,point:s}}pathL(t,e){const{pathParser:s}=this;const{current:n,point:i}=PathElement.pathL(s);const{x:r,y:o}=i;s.addMarker(i,n);e.addPoint(r,o);t&&t.lineTo(r,o)}static pathH(t){const{current:e,command:s}=t;const n=new Point((s.relative?e.x:0)+s.x,e.y);t.current=n;return{current:e,point:n}}pathH(t,e){const{pathParser:s}=this;const{current:n,point:i}=PathElement.pathH(s);const{x:r,y:o}=i;s.addMarker(i,n);e.addPoint(r,o);t&&t.lineTo(r,o)}static pathV(t){const{current:e,command:s}=t;const n=new Point(e.x,(s.relative?e.y:0)+s.y);t.current=n;return{current:e,point:n}}pathV(t,e){const{pathParser:s}=this;const{current:n,point:i}=PathElement.pathV(s);const{x:r,y:o}=i;s.addMarker(i,n);e.addPoint(r,o);t&&t.lineTo(r,o)}static pathC(t){const{current:e}=t;const s=t.getPoint("x1","y1");const n=t.getAsControlPoint("x2","y2");const i=t.getAsCurrentPoint();return{current:e,point:s,controlPoint:n,currentPoint:i}}pathC(t,e){const{pathParser:s}=this;const{current:n,point:i,controlPoint:r,currentPoint:o}=PathElement.pathC(s);s.addMarker(o,r,i);e.addBezierCurve(n.x,n.y,i.x,i.y,r.x,r.y,o.x,o.y);t&&t.bezierCurveTo(i.x,i.y,r.x,r.y,o.x,o.y)}static pathS(t){const{current:e}=t;const s=t.getReflectedControlPoint();const n=t.getAsControlPoint("x2","y2");const i=t.getAsCurrentPoint();return{current:e,point:s,controlPoint:n,currentPoint:i}}pathS(t,e){const{pathParser:s}=this;const{current:n,point:i,controlPoint:r,currentPoint:o}=PathElement.pathS(s);s.addMarker(o,r,i);e.addBezierCurve(n.x,n.y,i.x,i.y,r.x,r.y,o.x,o.y);t&&t.bezierCurveTo(i.x,i.y,r.x,r.y,o.x,o.y)}static pathQ(t){const{current:e}=t;const s=t.getAsControlPoint("x1","y1");const n=t.getAsCurrentPoint();return{current:e,controlPoint:s,currentPoint:n}}pathQ(t,e){const{pathParser:s}=this;const{current:n,controlPoint:i,currentPoint:r}=PathElement.pathQ(s);s.addMarker(r,i,i);e.addQuadraticCurve(n.x,n.y,i.x,i.y,r.x,r.y);t&&t.quadraticCurveTo(i.x,i.y,r.x,r.y)}static pathT(t){const{current:e}=t;const s=t.getReflectedControlPoint();t.control=s;const n=t.getAsCurrentPoint();return{current:e,controlPoint:s,currentPoint:n}}pathT(t,e){const{pathParser:s}=this;const{current:n,controlPoint:i,currentPoint:r}=PathElement.pathT(s);s.addMarker(r,i,i);e.addQuadraticCurve(n.x,n.y,i.x,i.y,r.x,r.y);t&&t.quadraticCurveTo(i.x,i.y,r.x,r.y)}static pathA(t){const{current:e,command:s}=t;let{rX:n,rY:i,xRot:r,lArcFlag:o,sweepFlag:a}=s;const h=r*(Math.PI/180);const l=t.getAsCurrentPoint();const u=new Point(Math.cos(h)*(e.x-l.x)/2+Math.sin(h)*(e.y-l.y)/2,-Math.sin(h)*(e.x-l.x)/2+Math.cos(h)*(e.y-l.y)/2);const g=Math.pow(u.x,2)/Math.pow(n,2)+Math.pow(u.y,2)/Math.pow(i,2);if(g>1){n*=Math.sqrt(g);i*=Math.sqrt(g)}let d=(o===a?-1:1)*Math.sqrt((Math.pow(n,2)*Math.pow(i,2)-Math.pow(n,2)*Math.pow(u.y,2)-Math.pow(i,2)*Math.pow(u.x,2))/(Math.pow(n,2)*Math.pow(u.y,2)+Math.pow(i,2)*Math.pow(u.x,2)));isNaN(d)&&(d=0);const p=new Point(d*n*u.y/i,d*-i*u.x/n);const f=new Point((e.x+l.x)/2+Math.cos(h)*p.x-Math.sin(h)*p.y,(e.y+l.y)/2+Math.sin(h)*p.x+Math.cos(h)*p.y);const y=vectorsAngle([1,0],[(u.x-p.x)/n,(u.y-p.y)/i]);const x=[(u.x-p.x)/n,(u.y-p.y)/i];const P=[(-u.x-p.x)/n,(-u.y-p.y)/i];let b=vectorsAngle(x,P);vectorsRatio(x,P)<=-1&&(b=Math.PI);vectorsRatio(x,P)>=1&&(b=0);return{currentPoint:l,rX:n,rY:i,sweepFlag:a,xAxisRotation:h,centp:f,a1:y,ad:b}}pathA(t,e){const{pathParser:s}=this;const{currentPoint:n,rX:i,rY:r,sweepFlag:o,xAxisRotation:a,centp:h,a1:l,ad:u}=PathElement.pathA(s);const g=1-o?1:-1;const d=l+g*(u/2);const p=new Point(h.x+i*Math.cos(d),h.y+r*Math.sin(d));s.addMarkerAngle(p,d-g*Math.PI/2);s.addMarkerAngle(n,d-g*Math.PI);e.addPoint(n.x,n.y);if(t&&!isNaN(l)&&!isNaN(u)){const e=i>r?i:r;const s=i>r?1:i/r;const n=i>r?r/i:1;t.translate(h.x,h.y);t.rotate(a);t.scale(s,n);t.arc(0,0,e,l,l+u,Boolean(1-o));t.scale(1/s,1/n);t.rotate(-a);t.translate(-h.x,-h.y)}}static pathZ(t){t.current=t.start}pathZ(t,e){PathElement.pathZ(this.pathParser);t&&e.x1!==e.x2&&e.y1!==e.y2&&t.closePath()}constructor(t,e,s){super(t,e,s);this.type="path";this.pathParser=new PathParser(this.getAttribute("d").getString())}}class SVGElement extends RenderedElement{setContext(t){var e;const{document:s}=this;const{screen:n,window:i}=s;const r=t.canvas;n.setDefaults(t);if("style"in r&&typeof t.font!=="undefined"&&i&&typeof i.getComputedStyle!=="undefined"){t.font=i.getComputedStyle(r).getPropertyValue("font");const e=new Property(s,"fontSize",Font.parse(t.font).fontSize);if(e.hasValue()){s.rootEmSize=e.getPixels("y");s.emSize=s.rootEmSize}}this.getAttribute("x").hasValue()||this.getAttribute("x",true).setValue(0);this.getAttribute("y").hasValue()||this.getAttribute("y",true).setValue(0);let{width:o,height:a}=n.viewPort;this.getStyle("width").hasValue()||this.getStyle("width",true).setValue("100%");this.getStyle("height").hasValue()||this.getStyle("height",true).setValue("100%");this.getStyle("color").hasValue()||this.getStyle("color",true).setValue("black");const h=this.getAttribute("refX");const l=this.getAttribute("refY");const u=this.getAttribute("viewBox");const g=u.hasValue()?toNumbers(u.getString()):null;const d=!this.root&&this.getStyle("overflow").getValue("hidden")!=="visible";let p=0;let f=0;let y=0;let x=0;if(g){p=g[0];f=g[1]}if(!this.root){o=this.getStyle("width").getPixels("x");a=this.getStyle("height").getPixels("y");if(this.type==="marker"){y=p;x=f;p=0;f=0}}n.viewPort.setCurrent(o,a);!this.node||this.parent&&((e=this.node.parentNode)===null||e===void 0?void 0:e.nodeName)!=="foreignObject"||!this.getStyle("transform",false,true).hasValue()||this.getStyle("transform-origin",false,true).hasValue()||this.getStyle("transform-origin",true,true).setValue("50% 50%");super.setContext(t);t.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y"));if(g){o=g[2];a=g[3]}s.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:n.viewPort.width,desiredWidth:o,height:n.viewPort.height,desiredHeight:a,minX:p,minY:f,refX:h.getValue(),refY:l.getValue(),clip:d,clipX:y,clipY:x});if(g){n.viewPort.removeCurrent();n.viewPort.setCurrent(o,a)}}clearContext(t){super.clearContext(t);this.document.screen.viewPort.removeCurrent()}
/**
   * Resize SVG to fit in given size.
   * @param width
   * @param height
   * @param preserveAspectRatio
   */resize(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const n=this.getAttribute("width",true);const i=this.getAttribute("height",true);const r=this.getAttribute("viewBox");const o=this.getAttribute("style");const a=n.getNumber(0);const h=i.getNumber(0);if(s)if(typeof s==="string")this.getAttribute("preserveAspectRatio",true).setValue(s);else{const t=this.getAttribute("preserveAspectRatio");t.hasValue()&&t.setValue(t.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}n.setValue(t);i.setValue(e);r.hasValue()||r.setValue("0 0 ".concat(a||t," ").concat(h||e));if(o.hasValue()){const s=this.getStyle("width");const n=this.getStyle("height");s.hasValue()&&s.setValue("".concat(t,"px"));n.hasValue()&&n.setValue("".concat(e,"px"))}}constructor(...t){super(...t);this.type="svg";this.root=false}}class RectElement extends PathElement{path(t){const e=this.getAttribute("x").getPixels("x");const s=this.getAttribute("y").getPixels("y");const n=this.getStyle("width",false,true).getPixels("x");const i=this.getStyle("height",false,true).getPixels("y");const r=this.getAttribute("rx");const o=this.getAttribute("ry");let a=r.getPixels("x");let h=o.getPixels("y");r.hasValue()&&!o.hasValue()&&(h=a);o.hasValue()&&!r.hasValue()&&(a=h);a=Math.min(a,n/2);h=Math.min(h,i/2);if(t){const r=(Math.sqrt(2)-1)/3*4;t.beginPath();if(i>0&&n>0){t.moveTo(e+a,s);t.lineTo(e+n-a,s);t.bezierCurveTo(e+n-a+r*a,s,e+n,s+h-r*h,e+n,s+h);t.lineTo(e+n,s+i-h);t.bezierCurveTo(e+n,s+i-h+r*h,e+n-a+r*a,s+i,e+n-a,s+i);t.lineTo(e+a,s+i);t.bezierCurveTo(e+a-r*a,s+i,e,s+i-h+r*h,e,s+i-h);t.lineTo(e,s+h);t.bezierCurveTo(e,s+h-r*h,e+a-r*a,s,e+a,s);t.closePath()}}return new BoundingBox(e,s,e+n,s+i)}getMarkers(){return null}constructor(...t){super(...t);this.type="rect"}}class CircleElement extends PathElement{path(t){const e=this.getAttribute("cx").getPixels("x");const s=this.getAttribute("cy").getPixels("y");const n=this.getAttribute("r").getPixels();if(t&&n>0){t.beginPath();t.arc(e,s,n,0,Math.PI*2,false);t.closePath()}return new BoundingBox(e-n,s-n,e+n,s+n)}getMarkers(){return null}constructor(...t){super(...t);this.type="circle"}}class EllipseElement extends PathElement{path(t){const e=(Math.sqrt(2)-1)/3*4;const s=this.getAttribute("rx").getPixels("x");const n=this.getAttribute("ry").getPixels("y");const i=this.getAttribute("cx").getPixels("x");const r=this.getAttribute("cy").getPixels("y");if(t&&s>0&&n>0){t.beginPath();t.moveTo(i+s,r);t.bezierCurveTo(i+s,r+e*n,i+e*s,r+n,i,r+n);t.bezierCurveTo(i-e*s,r+n,i-s,r+e*n,i-s,r);t.bezierCurveTo(i-s,r-e*n,i-e*s,r-n,i,r-n);t.bezierCurveTo(i+e*s,r-n,i+s,r-e*n,i+s,r);t.closePath()}return new BoundingBox(i-s,r-n,i+s,r+n)}getMarkers(){return null}constructor(...t){super(...t);this.type="ellipse"}}class LineElement extends PathElement{getPoints(){return[new Point(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new Point(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}path(t){const[{x:e,y:s},{x:n,y:i}]=this.getPoints();if(t){t.beginPath();t.moveTo(e,s);t.lineTo(n,i)}return new BoundingBox(e,s,n,i)}getMarkers(){const[t,e]=this.getPoints();const s=t.angleTo(e);return[[t,s],[e,s]]}constructor(...t){super(...t);this.type="line"}}class PolylineElement extends PathElement{path(t){const{points:e}=this;const[{x:s,y:n}]=e;const i=new BoundingBox(s,n);if(t){t.beginPath();t.moveTo(s,n)}e.forEach((e=>{let{x:s,y:n}=e;i.addPoint(s,n);t&&t.lineTo(s,n)}));return i}getMarkers(){const{points:t}=this;const e=t.length-1;const s=[];t.forEach(((n,i)=>{i!==e&&s.push([n,n.angleTo(t[i+1])])}));s.length>0&&s.push([t[t.length-1],s[s.length-1][1]]);return s}constructor(t,e,s){super(t,e,s);this.type="polyline";this.points=[];this.points=Point.parsePath(this.getAttribute("points").getString())}}class PolygonElement extends PolylineElement{path(t){const e=super.path(t);const[{x:s,y:n}]=this.points;if(t){t.lineTo(s,n);t.closePath()}return e}constructor(...t){super(...t);this.type="polygon"}}class PatternElement extends Element{createPattern(t,e,s){const n=this.getStyle("width").getPixels("x",true);const i=this.getStyle("height").getPixels("y",true);const r=new SVGElement(this.document,null);r.attributes.viewBox=new Property(this.document,"viewBox",this.getAttribute("viewBox").getValue());r.attributes.width=new Property(this.document,"width","".concat(n,"px"));r.attributes.height=new Property(this.document,"height","".concat(i,"px"));r.attributes.transform=new Property(this.document,"transform",this.getAttribute("patternTransform").getValue());r.children=this.children;const o=this.document.createCanvas(n,i);const a=o.getContext("2d");const h=this.getAttribute("x");const l=this.getAttribute("y");h.hasValue()&&l.hasValue()&&a.translate(h.getPixels("x",true),l.getPixels("y",true));s.hasValue()?this.styles["fill-opacity"]=s:Reflect.deleteProperty(this.styles,"fill-opacity");for(let t=-1;t<=1;t++)for(let e=-1;e<=1;e++){a.save();r.attributes.x=new Property(this.document,"x",t*o.width);r.attributes.y=new Property(this.document,"y",e*o.height);r.render(a);a.restore()}const u=t.createPattern(o,"repeat");return u}constructor(...t){super(...t);this.type="pattern"}}class MarkerElement extends Element{render(t,e,s){if(!e)return;const{x:n,y:i}=e;const r=this.getAttribute("orient").getString("auto");const o=this.getAttribute("markerUnits").getString("strokeWidth");t.translate(n,i);r==="auto"&&t.rotate(s);o==="strokeWidth"&&t.scale(t.lineWidth,t.lineWidth);t.save();const a=new SVGElement(this.document);a.type=this.type;a.attributes.viewBox=new Property(this.document,"viewBox",this.getAttribute("viewBox").getValue());a.attributes.refX=new Property(this.document,"refX",this.getAttribute("refX").getValue());a.attributes.refY=new Property(this.document,"refY",this.getAttribute("refY").getValue());a.attributes.width=new Property(this.document,"width",this.getAttribute("markerWidth").getValue());a.attributes.height=new Property(this.document,"height",this.getAttribute("markerHeight").getValue());a.attributes.overflow=new Property(this.document,"overflow",this.getAttribute("overflow").getValue());a.attributes.fill=new Property(this.document,"fill",this.getAttribute("fill").getColor("black"));a.attributes.stroke=new Property(this.document,"stroke",this.getAttribute("stroke").getValue("none"));a.children=this.children;a.render(t);t.restore();o==="strokeWidth"&&t.scale(1/t.lineWidth,1/t.lineWidth);r==="auto"&&t.rotate(-s);t.translate(-n,-i)}constructor(...t){super(...t);this.type="marker"}}class DefsElement extends Element{render(){}constructor(...t){super(...t);this.type="defs"}}class GElement extends RenderedElement{getBoundingBox(t){const e=new BoundingBox;this.children.forEach((s=>{e.addBoundingBox(s.getBoundingBox(t))}));return e}constructor(...t){super(...t);this.type="g"}}class GradientElement extends Element{getGradientUnits(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}createGradient(t,e,s){let n=this;if(this.getHrefAttribute().hasValue()){n=this.getHrefAttribute().getDefinition();this.inheritStopContainer(n)}const{stops:i}=n;const r=this.getGradient(t,e);if(!r)return this.addParentOpacity(s,i[i.length-1].color);i.forEach((t=>{r.addColorStop(t.offset,this.addParentOpacity(s,t.color))}));if(this.getAttribute("gradientTransform").hasValue()){const{document:t}=this;const{MAX_VIRTUAL_PIXELS:e}=Screen;const{viewPort:s}=t.screen;const n=s.getRoot();const i=new RectElement(t);i.attributes.x=new Property(t,"x",-e/3);i.attributes.y=new Property(t,"y",-e/3);i.attributes.width=new Property(t,"width",e);i.attributes.height=new Property(t,"height",e);const o=new GElement(t);o.attributes.transform=new Property(t,"transform",this.getAttribute("gradientTransform").getValue());o.children=[i];const a=new SVGElement(t);a.attributes.x=new Property(t,"x",0);a.attributes.y=new Property(t,"y",0);a.attributes.width=new Property(t,"width",n.width);a.attributes.height=new Property(t,"height",n.height);a.children=[o];const h=t.createCanvas(n.width,n.height);const l=h.getContext("2d");l.fillStyle=r;a.render(l);return l.createPattern(h,"no-repeat")}return r}inheritStopContainer(t){this.attributesToInherit.forEach((e=>{!this.getAttribute(e).hasValue()&&t.getAttribute(e).hasValue()&&this.getAttribute(e,true).setValue(t.getAttribute(e).getValue())}))}addParentOpacity(t,e){if(t.hasValue()){const s=new Property(this.document,"color",e);return s.addOpacity(t).getColor()}return e}constructor(t,e,s){super(t,e,s);this.attributesToInherit=["gradientUnits"];this.stops=[];const{stops:n,children:i}=this;i.forEach((t=>{t.type==="stop"&&n.push(t)}))}}class LinearGradientElement extends GradientElement{getGradient(t,e){const s=this.getGradientUnits()==="objectBoundingBox";const n=s?e.getBoundingBox(t):null;if(s&&!n)return null;if(!this.getAttribute("x1").hasValue()&&!this.getAttribute("y1").hasValue()&&!this.getAttribute("x2").hasValue()&&!this.getAttribute("y2").hasValue()){this.getAttribute("x1",true).setValue(0);this.getAttribute("y1",true).setValue(0);this.getAttribute("x2",true).setValue(1);this.getAttribute("y2",true).setValue(0)}const i=s?n.x+n.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x");const r=s?n.y+n.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y");const o=s?n.x+n.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x");const a=s?n.y+n.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return i===o&&r===a?null:t.createLinearGradient(i,r,o,a)}constructor(t,e,s){super(t,e,s);this.type="linearGradient";this.attributesToInherit.push("x1","y1","x2","y2")}}class RadialGradientElement extends GradientElement{getGradient(t,e){const s=this.getGradientUnits()==="objectBoundingBox";const n=e.getBoundingBox(t);if(s&&!n)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",true).setValue("50%");this.getAttribute("cy").hasValue()||this.getAttribute("cy",true).setValue("50%");this.getAttribute("r").hasValue()||this.getAttribute("r",true).setValue("50%");const i=s?n.x+n.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x");const r=s?n.y+n.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y");let o=i;let a=r;this.getAttribute("fx").hasValue()&&(o=s?n.x+n.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x"));this.getAttribute("fy").hasValue()&&(a=s?n.y+n.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));const h=s?(n.width+n.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels();const l=this.getAttribute("fr").getPixels();return t.createRadialGradient(o,a,l,i,r,h)}constructor(t,e,s){super(t,e,s);this.type="radialGradient";this.attributesToInherit.push("cx","cy","r","fx","fy","fr")}}class StopElement extends Element{constructor(t,e,s){super(t,e,s);this.type="stop";const n=Math.max(0,Math.min(1,this.getAttribute("offset").getNumber()));const i=this.getStyle("stop-opacity");let r=this.getStyle("stop-color",true);r.getString()===""&&r.setValue("#000");i.hasValue()&&(r=r.addOpacity(i));this.offset=n;this.color=r.getColor()}}class AnimateElement extends Element{getProperty(){const t=this.getAttribute("attributeType").getString();const e=this.getAttribute("attributeName").getString();return t==="CSS"?this.parent.getStyle(e,true):this.parent.getAttribute(e,true)}calcValue(){const{initialUnits:t}=this;const{progress:e,from:s,to:n}=this.getProgress();let i=s.getNumber()+(n.getNumber()-s.getNumber())*e;t==="%"&&(i*=100);return"".concat(i).concat(t)}update(t){const{parent:e}=this;const s=this.getProperty();if(!this.initialValue){this.initialValue=s.getString();this.initialUnits=s.getUnits()}if(this.duration>this.maxDuration){const t=this.getAttribute("fill").getString("remove");if(this.getAttribute("repeatCount").getString()==="indefinite"||this.getAttribute("repeatDur").getString()==="indefinite")this.duration=0;else if(t!=="freeze"||this.frozen){if(t==="remove"&&!this.removed){this.removed=true;e&&s&&s.setValue(e.animationFrozen?e.animationFrozenValue:this.initialValue);return true}}else{this.frozen=true;if(e&&s){e.animationFrozen=true;e.animationFrozenValue=s.getString()}}return false}this.duration+=t;let n=false;if(this.begin<this.duration){let t=this.calcValue();const e=this.getAttribute("type");if(e.hasValue()){const s=e.getString();t="".concat(s,"(").concat(t,")")}s.setValue(t);n=true}return n}getProgress(){const{document:t,values:e}=this;let s=(this.duration-this.begin)/(this.maxDuration-this.begin);let n;let i;if(e.hasValue()){const r=s*(e.getValue().length-1);const o=Math.floor(r);const a=Math.ceil(r);let h;h=e.getValue()[o];n=new Property(t,"from",h?parseFloat(h):0);h=e.getValue()[a];i=new Property(t,"to",h?parseFloat(h):0);s=(r-o)/(a-o)}else{n=this.from;i=this.to}return{progress:s,from:n,to:i}}constructor(t,e,s){super(t,e,s);this.type="animate";this.duration=0;this.initialUnits="";this.removed=false;this.frozen=false;t.screen.animations.push(this);this.begin=this.getAttribute("begin").getMilliseconds();this.maxDuration=this.begin+this.getAttribute("dur").getMilliseconds();this.from=this.getAttribute("from");this.to=this.getAttribute("to");this.values=new Property(t,"values",null);const n=this.getAttribute("values");n.hasValue()&&this.values.setValue(n.getString().split(";"))}}class AnimateColorElement extends AnimateElement{calcValue(){const{progress:t,from:s,to:n}=this.getProgress();const i=new e(s.getColor());const r=new e(n.getColor());if(i.ok&&r.ok){const e=i.r+(r.r-i.r)*t;const s=i.g+(r.g-i.g)*t;const n=i.b+(r.b-i.b)*t;return"rgb(".concat(Math.floor(e),", ").concat(Math.floor(s),", ").concat(Math.floor(n),")")}return this.getAttribute("from").getColor()}constructor(...t){super(...t);this.type="animateColor"}}class AnimateTransformElement extends AnimateElement{calcValue(){const{progress:t,from:e,to:s}=this.getProgress();const n=toNumbers(e.getString());const i=toNumbers(s.getString());const r=n.map(((e,s)=>{const n=i[s];return e+(n-e)*t})).join(" ");return r}constructor(...t){super(...t);this.type="animateTransform"}}class FontFaceElement extends Element{constructor(t,e,s){super(t,e,s);this.type="font-face";this.ascent=this.getAttribute("ascent").getNumber();this.descent=this.getAttribute("descent").getNumber();this.unitsPerEm=this.getAttribute("units-per-em").getNumber()}}class GlyphElement extends PathElement{constructor(t,e,s){super(t,e,s);this.type="glyph";this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();this.unicode=this.getAttribute("unicode").getString();this.arabicForm=this.getAttribute("arabic-form").getString()}}class MissingGlyphElement extends GlyphElement{constructor(...t){super(...t);this.type="missing-glyph";this.horizAdvX=0}}class FontElement extends Element{render(){}constructor(t,e,s){super(t,e,s);this.type="font";this.isArabic=false;this.glyphs={};this.arabicGlyphs={};this.isRTL=false;this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();const{definitions:n}=t;const{children:i}=this;for(const t of i)if(t instanceof FontFaceElement){this.fontFace=t;const e=t.getStyle("font-family");e.hasValue()&&(n[e.getString()]=this)}else if(t instanceof MissingGlyphElement)this.missingGlyph=t;else if(t instanceof GlyphElement)if(t.arabicForm){this.isRTL=true;this.isArabic=true;const e=this.arabicGlyphs[t.unicode];typeof e==="undefined"?this.arabicGlyphs[t.unicode]={[t.arabicForm]:t}:e[t.arabicForm]=t}else this.glyphs[t.unicode]=t}}class TRefElement extends TextElement{getText(){const t=this.getHrefAttribute().getDefinition();if(t){const e=t.children[0];if(e)return e.getText()}return""}constructor(...t){super(...t);this.type="tref"}}class AElement extends TextElement{getText(){return this.text}renderChildren(t){if(this.hasText){super.renderChildren(t);const{document:e,x:s,y:n}=this;const{mouse:i}=e.screen;const r=new Property(e,"fontSize",Font.parse(e.ctx.font).fontSize);i.isWorking()&&i.checkBoundingBox(this,new BoundingBox(s,n-r.getPixels("y"),s+this.measureText(t),n))}else if(this.children.length>0){const e=new GElement(this.document);e.children=this.children;e.parent=this;e.render(t)}}onClick(){const{window:t}=this.document;t&&t.open(this.getHrefAttribute().getString())}onMouseMove(){const t=this.document.ctx;t.canvas.style.cursor="pointer"}constructor(t,e,s){super(t,e,s);this.type="a";const{childNodes:n}=e;const i=n[0];const r=n.length>0&&Array.from(n).every((t=>t.nodeType===3));this.hasText=r;this.text=r?this.getTextFromNode(i):""}}class TextPathElement extends TextElement{getText(){return this.text}path(t){const{dataArray:e}=this;t&&t.beginPath();e.forEach((e=>{let{type:s,points:n}=e;switch(s){case PathParser.LINE_TO:t&&t.lineTo(n[0],n[1]);break;case PathParser.MOVE_TO:t&&t.moveTo(n[0],n[1]);break;case PathParser.CURVE_TO:t&&t.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5]);break;case PathParser.QUAD_TO:t&&t.quadraticCurveTo(n[0],n[1],n[2],n[3]);break;case PathParser.ARC:{const[e,s,i,r,o,a,h,l]=n;const u=i>r?i:r;const g=i>r?1:i/r;const d=i>r?r/i:1;if(t){t.translate(e,s);t.rotate(h);t.scale(g,d);t.arc(0,0,u,o,o+a,Boolean(1-l));t.scale(1/g,1/d);t.rotate(-h);t.translate(-e,-s)}break}case PathParser.CLOSE_PATH:t&&t.closePath();break}}))}renderChildren(t){this.setTextData(t);t.save();const e=this.parent.getStyle("text-decoration").getString();const s=this.getFontSize();const{glyphInfo:n}=this;const i=t.fillStyle;e==="underline"&&t.beginPath();n.forEach(((n,i)=>{const{p0:r,p1:o,rotation:a,text:h}=n;t.save();t.translate(r.x,r.y);t.rotate(a);t.fillStyle&&t.fillText(h,0,0);t.strokeStyle&&t.strokeText(h,0,0);t.restore();if(e==="underline"){i===0&&t.moveTo(r.x,r.y+s/8);t.lineTo(o.x,o.y+s/5)}}));if(e==="underline"){t.lineWidth=s/20;t.strokeStyle=i;t.stroke();t.closePath()}t.restore()}getLetterSpacingAt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.letterSpacingCache[t]||0}findSegmentToFitChar(t,e,s,n,i,r,o,a,h){let l=r;let u=this.measureText(t,a);a===" "&&e==="justify"&&s<n&&(u+=(n-s)/i);h>-1&&(l+=this.getLetterSpacingAt(h));const g=this.textHeight/20;const d=this.getEquidistantPointOnPath(l,g,0);const p=this.getEquidistantPointOnPath(l+u,g,0);const f={p0:d,p1:p};const y=d&&p?Math.atan2(p.y-d.y,p.x-d.x):0;if(o){const t=Math.cos(Math.PI/2+y)*o;const e=Math.cos(-y)*o;f.p0={...d,x:d.x+t,y:d.y+e};f.p1={...p,x:p.x+t,y:p.y+e}}l+=u;return{offset:l,segment:f,rotation:y}}measureText(t,e){const{measuresCache:s}=this;const n=e||this.getText();if(s.has(n))return s.get(n);const i=this.measureTargetText(t,n);s.set(n,i);return i}setTextData(t){if(this.glyphInfo)return;const e=this.getText();const s=e.split("");const n=e.split(" ").length-1;const i=this.parent.getAttribute("dx").split().map((t=>t.getPixels("x")));const r=this.parent.getAttribute("dy").getPixels("y");const o=this.parent.getStyle("text-anchor").getString("start");const a=this.getStyle("letter-spacing");const h=this.parent.getStyle("letter-spacing");let l=0;a.hasValue()&&a.getValue()!=="inherit"?a.hasValue()&&a.getValue()!=="initial"&&a.getValue()!=="unset"&&(l=a.getPixels()):l=h.getPixels();const u=[];const g=e.length;this.letterSpacingCache=u;for(let t=0;t<g;t++)u.push(typeof i[t]!=="undefined"?i[t]:l);const d=u.reduce(((t,e,s)=>s===0?0:t+e||0),0);const p=this.measureText(t);const f=Math.max(p+d,0);this.textWidth=p;this.textHeight=this.getFontSize();this.glyphInfo=[];const y=this.getPathLength();const x=this.getStyle("startOffset").getNumber(0)*y;let P=0;o!=="middle"&&o!=="center"||(P=-f/2);o!=="end"&&o!=="right"||(P=-f);P+=x;s.forEach(((e,i)=>{const{offset:a,segment:h,rotation:l}=this.findSegmentToFitChar(t,o,f,y,n,P,r,e,i);P=a;h.p0&&h.p1&&this.glyphInfo.push({text:s[i],p0:h.p0,p1:h.p1,rotation:l})}))}parsePathData(t){this.pathLength=-1;if(!t)return[];const e=[];const{pathParser:s}=t;s.reset();while(!s.isEnd()){const{current:t}=s;const n=t?t.x:0;const i=t?t.y:0;const r=s.next();let o=r.type;let a=[];switch(r.type){case PathParser.MOVE_TO:this.pathM(s,a);break;case PathParser.LINE_TO:o=this.pathL(s,a);break;case PathParser.HORIZ_LINE_TO:o=this.pathH(s,a);break;case PathParser.VERT_LINE_TO:o=this.pathV(s,a);break;case PathParser.CURVE_TO:this.pathC(s,a);break;case PathParser.SMOOTH_CURVE_TO:o=this.pathS(s,a);break;case PathParser.QUAD_TO:this.pathQ(s,a);break;case PathParser.SMOOTH_QUAD_TO:o=this.pathT(s,a);break;case PathParser.ARC:a=this.pathA(s);break;case PathParser.CLOSE_PATH:PathElement.pathZ(s);break}r.type!==PathParser.CLOSE_PATH?e.push({type:o,points:a,start:{x:n,y:i},pathLength:this.calcLength(n,i,o,a)}):e.push({type:PathParser.CLOSE_PATH,points:[],pathLength:0})}return e}pathM(t,e){const{x:s,y:n}=PathElement.pathM(t).point;e.push(s,n)}pathL(t,e){const{x:s,y:n}=PathElement.pathL(t).point;e.push(s,n);return PathParser.LINE_TO}pathH(t,e){const{x:s,y:n}=PathElement.pathH(t).point;e.push(s,n);return PathParser.LINE_TO}pathV(t,e){const{x:s,y:n}=PathElement.pathV(t).point;e.push(s,n);return PathParser.LINE_TO}pathC(t,e){const{point:s,controlPoint:n,currentPoint:i}=PathElement.pathC(t);e.push(s.x,s.y,n.x,n.y,i.x,i.y)}pathS(t,e){const{point:s,controlPoint:n,currentPoint:i}=PathElement.pathS(t);e.push(s.x,s.y,n.x,n.y,i.x,i.y);return PathParser.CURVE_TO}pathQ(t,e){const{controlPoint:s,currentPoint:n}=PathElement.pathQ(t);e.push(s.x,s.y,n.x,n.y)}pathT(t,e){const{controlPoint:s,currentPoint:n}=PathElement.pathT(t);e.push(s.x,s.y,n.x,n.y);return PathParser.QUAD_TO}pathA(t){let{rX:e,rY:s,sweepFlag:n,xAxisRotation:i,centp:r,a1:o,ad:a}=PathElement.pathA(t);n===0&&a>0&&(a-=2*Math.PI);n===1&&a<0&&(a+=2*Math.PI);return[r.x,r.y,e,s,o,a,i,n]}calcLength(t,e,s,n){let i=0;let r=null;let o=null;let a=0;switch(s){case PathParser.LINE_TO:return this.getLineLength(t,e,n[0],n[1]);case PathParser.CURVE_TO:i=0;r=this.getPointOnCubicBezier(0,t,e,n[0],n[1],n[2],n[3],n[4],n[5]);for(a=.01;a<=1;a+=.01){o=this.getPointOnCubicBezier(a,t,e,n[0],n[1],n[2],n[3],n[4],n[5]);i+=this.getLineLength(r.x,r.y,o.x,o.y);r=o}return i;case PathParser.QUAD_TO:i=0;r=this.getPointOnQuadraticBezier(0,t,e,n[0],n[1],n[2],n[3]);for(a=.01;a<=1;a+=.01){o=this.getPointOnQuadraticBezier(a,t,e,n[0],n[1],n[2],n[3]);i+=this.getLineLength(r.x,r.y,o.x,o.y);r=o}return i;case PathParser.ARC:{i=0;const t=n[4];const e=n[5];const s=n[4]+e;let h=Math.PI/180;Math.abs(t-s)<h&&(h=Math.abs(t-s));r=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],t,0);if(e<0)for(a=t-h;a>s;a-=h){o=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],a,0);i+=this.getLineLength(r.x,r.y,o.x,o.y);r=o}else for(a=t+h;a<s;a+=h){o=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],a,0);i+=this.getLineLength(r.x,r.y,o.x,o.y);r=o}o=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],s,0);i+=this.getLineLength(r.x,r.y,o.x,o.y);return i}}return 0}getPointOnLine(t,e,s,n,i){let r=arguments.length>5&&arguments[5]!==void 0?arguments[5]:e,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:s;const a=(i-s)/(n-e+p);let h=Math.sqrt(t*t/(1+a*a));n<e&&(h*=-1);let l=a*h;let u=null;if(n===e)u={x:r,y:o+l};else if((o-s)/(r-e+p)===a)u={x:r+h,y:o+l};else{let g=0;let d=0;const f=this.getLineLength(e,s,n,i);if(f<p)return null;let y=(r-e)*(n-e)+(o-s)*(i-s);y/=f*f;g=e+y*(n-e);d=s+y*(i-s);const x=this.getLineLength(r,o,g,d);const P=Math.sqrt(t*t-x*x);h=Math.sqrt(P*P/(1+a*a));n<e&&(h*=-1);l=a*h;u={x:g+h,y:d+l}}return u}getPointOnPath(t){const e=this.getPathLength();let s=0;let n=null;if(t<-5e-5||t-5e-5>e)return null;const{dataArray:i}=this;for(const e of i){if(e&&(e.pathLength<5e-5||s+e.pathLength+5e-5<t)){s+=e.pathLength;continue}const i=t-s;let r=0;switch(e.type){case PathParser.LINE_TO:n=this.getPointOnLine(i,e.start.x,e.start.y,e.points[0],e.points[1],e.start.x,e.start.y);break;case PathParser.ARC:{const t=e.points[4];const s=e.points[5];const o=e.points[4]+s;r=t+i/e.pathLength*s;if(s<0&&r<o||s>=0&&r>o)break;n=this.getPointOnEllipticalArc(e.points[0],e.points[1],e.points[2],e.points[3],r,e.points[6]);break}case PathParser.CURVE_TO:r=i/e.pathLength;r>1&&(r=1);n=this.getPointOnCubicBezier(r,e.start.x,e.start.y,e.points[0],e.points[1],e.points[2],e.points[3],e.points[4],e.points[5]);break;case PathParser.QUAD_TO:r=i/e.pathLength;r>1&&(r=1);n=this.getPointOnQuadraticBezier(r,e.start.x,e.start.y,e.points[0],e.points[1],e.points[2],e.points[3]);break}if(n)return n;break}return null}getLineLength(t,e,s,n){return Math.sqrt((s-t)*(s-t)+(n-e)*(n-e))}getPathLength(){this.pathLength===-1&&(this.pathLength=this.dataArray.reduce(((t,e)=>e.pathLength>0?t+e.pathLength:t),0));return this.pathLength}getPointOnCubicBezier(t,e,s,n,i,r,o,a,h){const l=a*CB1(t)+r*CB2(t)+n*CB3(t)+e*CB4(t);const u=h*CB1(t)+o*CB2(t)+i*CB3(t)+s*CB4(t);return{x:l,y:u}}getPointOnQuadraticBezier(t,e,s,n,i,r,o){const a=r*QB1(t)+n*QB2(t)+e*QB3(t);const h=o*QB1(t)+i*QB2(t)+s*QB3(t);return{x:a,y:h}}getPointOnEllipticalArc(t,e,s,n,i,r){const o=Math.cos(r);const a=Math.sin(r);const h={x:s*Math.cos(i),y:n*Math.sin(i)};return{x:t+(h.x*o-h.y*a),y:e+(h.x*a+h.y*o)}}buildEquidistantCache(t,e){const s=this.getPathLength();const n=e||.25;const i=t||s/100;if(!this.equidistantCache||this.equidistantCache.step!==i||this.equidistantCache.precision!==n){this.equidistantCache={step:i,precision:n,points:[]};let t=0;for(let e=0;e<=s;e+=n){const s=this.getPointOnPath(e);const r=this.getPointOnPath(e+n);if(s&&r){t+=this.getLineLength(s.x,s.y,r.x,r.y);if(t>=i){this.equidistantCache.points.push({x:s.x,y:s.y,distance:e});t-=i}}}}}getEquidistantPointOnPath(t,e,s){this.buildEquidistantCache(e,s);if(t<0||t-this.getPathLength()>5e-5)return null;const n=Math.round(t/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[n]||null}constructor(t,e,s){super(t,e,s);this.type="textPath";this.textWidth=0;this.textHeight=0;this.pathLength=-1;this.glyphInfo=null;this.letterSpacingCache=[];this.measuresCache=new Map([["",0]]);const n=this.getHrefAttribute().getDefinition();this.text=this.getTextFromNode();this.dataArray=this.parsePathData(n)}}const b=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*)$/i;class ImageElement extends RenderedElement{async loadImage(t){try{const e=await this.document.createImage(t);this.image=e}catch(e){console.error('Error while loading image "'.concat(t,'":'),e)}this.loaded=true}async loadSvg(t){const e=b.exec(t);if(e){const t=e[5];t&&(e[4]==="base64"?this.image=atob(t):this.image=decodeURIComponent(t))}else try{const e=await this.document.fetch(t);const s=await e.text();this.image=s}catch(e){console.error('Error while loading image "'.concat(t,'":'),e)}this.loaded=true}renderChildren(t){const{document:e,image:s,loaded:n}=this;const i=this.getAttribute("x").getPixels("x");const r=this.getAttribute("y").getPixels("y");const o=this.getStyle("width").getPixels("x");const a=this.getStyle("height").getPixels("y");if(n&&s&&o&&a){t.save();t.translate(i,r);if(typeof s==="string"){const n=e.canvg.forkString(t,s,{ignoreMouse:true,ignoreAnimation:true,ignoreDimensions:true,ignoreClear:true,offsetX:0,offsetY:0,scaleWidth:o,scaleHeight:a});const{documentElement:i}=n.document;i&&(i.parent=this);void n.render()}else{e.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:o,desiredWidth:s.width,height:a,desiredHeight:s.height});this.loaded&&("complete"in s&&!s.complete||t.drawImage(s,0,0))}t.restore()}}getBoundingBox(){const t=this.getAttribute("x").getPixels("x");const e=this.getAttribute("y").getPixels("y");const s=this.getStyle("width").getPixels("x");const n=this.getStyle("height").getPixels("y");return new BoundingBox(t,e,t+s,e+n)}constructor(t,e,s){super(t,e,s);this.type="image";this.loaded=false;const n=this.getHrefAttribute().getString();if(!n)return;const i=n.endsWith(".svg")||/^\s*data:image\/svg\+xml/i.test(n);t.images.push(this);i?void this.loadSvg(n):void this.loadImage(n)}}class SymbolElement extends RenderedElement{render(t){}constructor(...t){super(...t);this.type="symbol"}}class SVGFontLoader{async load(t,e){try{const{document:s}=this;const n=await s.canvg.parser.load(e);const i=n.getElementsByTagName("font");Array.from(i).forEach((e=>{const n=s.createElement(e);s.definitions[t]=n}))}catch(t){console.error('Error while loading font "'.concat(e,'":'),t)}this.loaded=true}constructor(t){this.document=t;this.loaded=false;t.fonts.push(this)}}class StyleElement extends Element{constructor(t,e,s){super(t,e,s);this.type="style";const n=compressSpaces(Array.from(e.childNodes).map((t=>t.textContent)).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,""));const i=n.split("}");i.forEach((e=>{const s=e.trim();if(!s)return;const n=s.split("{");const i=n[0].split(",");const r=n[1].split(";");i.forEach((e=>{const s=e.trim();if(!s)return;const n=t.styles[s]||{};r.forEach((e=>{const s=e.indexOf(":");const i=e.substr(0,s).trim();const r=e.substr(s+1,e.length-s).trim();i&&r&&(n[i]=new Property(t,i,r))}));t.styles[s]=n;t.stylesSpecificity[s]=getSelectorSpecificity(s);if(s==="@font-face"){const e=n["font-family"].getString().replace(/"|'/g,"");const s=n.src.getString().split(",");s.forEach((s=>{if(s.indexOf('format("svg")')>0){const n=parseExternalUrl(s);n&&void new SVGFontLoader(t).load(e,n)}}))}}))}))}}StyleElement.parseExternalUrl=parseExternalUrl;class UseElement extends RenderedElement{setContext(t){super.setContext(t);const e=this.getAttribute("x");const s=this.getAttribute("y");e.hasValue()&&t.translate(e.getPixels("x"),0);s.hasValue()&&t.translate(0,s.getPixels("y"))}path(t){const{element:e}=this;e&&e.path(t)}renderChildren(t){const{document:e,element:s}=this;if(s){let n=s;if(s.type==="symbol"){n=new SVGElement(e);n.attributes.viewBox=new Property(e,"viewBox",s.getAttribute("viewBox").getString());n.attributes.preserveAspectRatio=new Property(e,"preserveAspectRatio",s.getAttribute("preserveAspectRatio").getString());n.attributes.overflow=new Property(e,"overflow",s.getAttribute("overflow").getString());n.children=s.children;s.styles.opacity=new Property(e,"opacity",this.calculateOpacity())}if(n.type==="svg"){const t=this.getStyle("width",false,true);const s=this.getStyle("height",false,true);t.hasValue()&&(n.attributes.width=new Property(e,"width",t.getString()));s.hasValue()&&(n.attributes.height=new Property(e,"height",s.getString()))}const i=n.parent;n.parent=this;n.render(t);n.parent=i}}getBoundingBox(t){const{element:e}=this;return e?e.getBoundingBox(t):null}elementTransform(){const{document:t,element:e}=this;return e?Transform.fromElement(t,e):null}get element(){this.cachedElement||(this.cachedElement=this.getHrefAttribute().getDefinition());return this.cachedElement}constructor(...t){super(...t);this.type="use"}}function imGet(t,e,s,n,i,r){return t[s*n*4+e*4+r]}function imSet(t,e,s,n,i,r,o){t[s*n*4+e*4+r]=o}function m(t,e,s){const n=t[e];return n*s}function c(t,e,s,n){return e+Math.cos(t)*s+Math.sin(t)*n}class FeColorMatrixElement extends Element{apply(t,e,s,n,i){const{includeOpacity:r,matrix:o}=this;const a=t.getImageData(0,0,n,i);for(let t=0;t<i;t++)for(let e=0;e<n;e++){const s=imGet(a.data,e,t,n,i,0);const h=imGet(a.data,e,t,n,i,1);const l=imGet(a.data,e,t,n,i,2);const u=imGet(a.data,e,t,n,i,3);let g=m(o,0,s)+m(o,1,h)+m(o,2,l)+m(o,3,u)+m(o,4,1);let d=m(o,5,s)+m(o,6,h)+m(o,7,l)+m(o,8,u)+m(o,9,1);let p=m(o,10,s)+m(o,11,h)+m(o,12,l)+m(o,13,u)+m(o,14,1);let f=m(o,15,s)+m(o,16,h)+m(o,17,l)+m(o,18,u)+m(o,19,1);if(r){g=0;d=0;p=0;f*=u/255}imSet(a.data,e,t,n,i,0,g);imSet(a.data,e,t,n,i,1,d);imSet(a.data,e,t,n,i,2,p);imSet(a.data,e,t,n,i,3,f)}t.clearRect(0,0,n,i);t.putImageData(a,0,0)}constructor(t,e,s){super(t,e,s);this.type="feColorMatrix";let n=toNumbers(this.getAttribute("values").getString());switch(this.getAttribute("type").getString("matrix")){case"saturate":{const t=n[0];n=[.213+.787*t,.715-.715*t,.072-.072*t,0,0,.213-.213*t,.715+.285*t,.072-.072*t,0,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,0,1,0,0,0,0,0,1];break}case"hueRotate":{const t=n[0]*Math.PI/180;n=[c(t,.213,.787,-.213),c(t,.715,-.715,-.715),c(t,.072,-.072,.928),0,0,c(t,.213,-.213,.143),c(t,.715,.285,.14),c(t,.072,-.072,-.283),0,0,c(t,.213,-.213,-.787),c(t,.715,-.715,.715),c(t,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break}case"luminanceToAlpha":n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}this.matrix=n;this.includeOpacity=this.getAttribute("includeOpacity").hasValue()}}class MaskElement extends Element{apply(t,e){const{document:s}=this;let n=this.getAttribute("x").getPixels("x");let i=this.getAttribute("y").getPixels("y");let r=this.getStyle("width").getPixels("x");let o=this.getStyle("height").getPixels("y");if(!r&&!o){const e=new BoundingBox;this.children.forEach((s=>{e.addBoundingBox(s.getBoundingBox(t))}));n=Math.floor(e.x1);i=Math.floor(e.y1);r=Math.floor(e.width);o=Math.floor(e.height)}const a=this.removeStyles(e,MaskElement.ignoreStyles);const h=s.createCanvas(n+r,i+o);const l=h.getContext("2d");s.screen.setDefaults(l);this.renderChildren(l);new FeColorMatrixElement(s,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(l,0,0,n+r,i+o);const u=s.createCanvas(n+r,i+o);const g=u.getContext("2d");s.screen.setDefaults(g);e.render(g);g.globalCompositeOperation="destination-in";g.fillStyle=l.createPattern(h,"no-repeat");g.fillRect(0,0,n+r,i+o);t.fillStyle=g.createPattern(u,"no-repeat");t.fillRect(0,0,n+r,i+o);this.restoreStyles(e,a)}render(t){}constructor(...t){super(...t);this.type="mask"}}MaskElement.ignoreStyles=["mask","transform","clip-path"];const noop=()=>{};class ClipPathElement extends Element{apply(t){const{document:e}=this;const s=Reflect.getPrototypeOf(t);const{beginPath:n,closePath:i}=t;if(s){s.beginPath=noop;s.closePath=noop}Reflect.apply(n,t,[]);this.children.forEach((n=>{if(!("path"in n))return;let r="elementTransform"in n?n.elementTransform():null;r||(r=Transform.fromElement(e,n));r&&r.apply(t);n.path(t);s&&(s.closePath=i);r&&r.unapply(t)}));Reflect.apply(i,t,[]);t.clip();if(s){s.beginPath=n;s.closePath=i}}render(t){}constructor(...t){super(...t);this.type="clipPath"}}class FilterElement extends Element{apply(t,e){const{document:s,children:n}=this;const i="getBoundingBox"in e?e.getBoundingBox(t):null;if(!i)return;let r=0;let o=0;n.forEach((t=>{const e=t.extraFilterDistance||0;r=Math.max(r,e);o=Math.max(o,e)}));const a=Math.floor(i.width);const h=Math.floor(i.height);const l=a+2*r;const u=h+2*o;if(l<1||u<1)return;const g=Math.floor(i.x);const d=Math.floor(i.y);const p=this.removeStyles(e,FilterElement.ignoreStyles);const f=s.createCanvas(l,u);const y=f.getContext("2d");s.screen.setDefaults(y);y.translate(-g+r,-d+o);e.render(y);n.forEach((t=>{typeof t.apply==="function"&&t.apply(y,0,0,l,u)}));t.drawImage(f,0,0,l,u,g-r,d-o,l,u);this.restoreStyles(e,p)}render(t){}constructor(...t){super(...t);this.type="filter"}}FilterElement.ignoreStyles=["filter","transform","clip-path"];class FeDropShadowElement extends Element{apply(t,e,s,n,i){}constructor(t,e,s){super(t,e,s);this.type="feDropShadow";this.addStylesFromStyleDefinition()}}class FeMorphologyElement extends Element{apply(t,e,s,n,i){}constructor(...t){super(...t);this.type="feMorphology"}}class FeCompositeElement extends Element{apply(t,e,s,n,i){}constructor(...t){super(...t);this.type="feComposite"}}class FeGaussianBlurElement extends Element{apply(t,e,s,i,r){const{document:o,blurRadius:a}=this;const h=o.window?o.window.document.body:null;const l=t.canvas;l.id=o.getUniqueId();if(h){l.style.display="none";h.appendChild(l)}n(l,e,s,i,r,a);h&&h.removeChild(l)}constructor(t,e,s){super(t,e,s);this.type="feGaussianBlur";this.blurRadius=Math.floor(this.getAttribute("stdDeviation").getNumber());this.extraFilterDistance=this.blurRadius}}class TitleElement extends Element{constructor(...t){super(...t);this.type="title"}}class DescElement extends Element{constructor(...t){super(...t);this.type="desc"}}const S={svg:SVGElement,rect:RectElement,circle:CircleElement,ellipse:EllipseElement,line:LineElement,polyline:PolylineElement,polygon:PolygonElement,path:PathElement,pattern:PatternElement,marker:MarkerElement,defs:DefsElement,linearGradient:LinearGradientElement,radialGradient:RadialGradientElement,stop:StopElement,animate:AnimateElement,animateColor:AnimateColorElement,animateTransform:AnimateTransformElement,font:FontElement,"font-face":FontFaceElement,"missing-glyph":MissingGlyphElement,glyph:GlyphElement,text:TextElement,tspan:TSpanElement,tref:TRefElement,a:AElement,textPath:TextPathElement,image:ImageElement,g:GElement,symbol:SymbolElement,style:StyleElement,use:UseElement,mask:MaskElement,clipPath:ClipPathElement,filter:FilterElement,feDropShadow:FeDropShadowElement,feMorphology:FeMorphologyElement,feComposite:FeCompositeElement,feColorMatrix:FeColorMatrixElement,feGaussianBlur:FeGaussianBlurElement,title:TitleElement,desc:DescElement};function createCanvas(t,e){const s=document.createElement("canvas");s.width=t;s.height=e;return s}async function createImage(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=document.createElement("img");e&&(s.crossOrigin="Anonymous");return new Promise(((e,n)=>{s.onload=()=>{e(s)};s.onerror=(t,e,s,i,r)=>{n(r)};s.src=t}))}const E=12;class Document{bindCreateImage(t,e){return typeof e==="boolean"?(s,n)=>t(s,typeof n==="boolean"?n:e):t}get window(){return this.screen.window}get fetch(){return this.screen.fetch}get ctx(){return this.screen.ctx}get emSize(){const{emSizeStack:t}=this;return t[t.length-1]||E}set emSize(t){const{emSizeStack:e}=this;e.push(t)}popEmSize(){const{emSizeStack:t}=this;t.pop()}getUniqueId(){return"canvg".concat(++this.uniqueId)}isImagesLoaded(){return this.images.every((t=>t.loaded))}isFontsLoaded(){return this.fonts.every((t=>t.loaded))}createDocumentElement(t){const e=this.createElement(t.documentElement);e.root=true;e.addStylesFromStyleDefinition();this.documentElement=e;return e}createElement(t){const e=t.nodeName.replace(/^[^:]+:/,"");const s=Document.elementTypes[e];return s?new s(this,t):new UnknownElement(this,t)}createTextNode(t){return new TextNode(this,t)}setViewBox(t){this.screen.setViewBox({document:this,...t})}constructor(t,{rootEmSize:e=E,emSize:s=E,createCanvas:n=Document.createCanvas,createImage:i=Document.createImage,anonymousCrossOrigin:r}={}){this.canvg=t;this.definitions={};this.styles={};this.stylesSpecificity={};this.images=[];this.fonts=[];this.emSizeStack=[];this.uniqueId=0;this.screen=t.screen;this.rootEmSize=e;this.emSize=s;this.createCanvas=n;this.createImage=this.bindCreateImage(i,r);this.screen.wait((()=>this.isImagesLoaded()));this.screen.wait((()=>this.isFontsLoaded()))}}Document.createCanvas=createCanvas;Document.createImage=createImage;Document.elementTypes=S;class Canvg{
/**
   * Create Canvg instance from SVG source string or URL.
   * @param ctx - Rendering context.
   * @param svg - SVG source string or URL.
   * @param options - Rendering options.
   * @returns Canvg instance.
   */
static async from(t,e){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=new Parser(s);const i=await n.parse(e);return new Canvg(t,i,s)}
/**
   * Create Canvg instance from SVG source string.
   * @param ctx - Rendering context.
   * @param svg - SVG source string.
   * @param options - Rendering options.
   * @returns Canvg instance.
   */static fromString(t,e){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=new Parser(s);const i=n.parseFromString(e);return new Canvg(t,i,s)}
/**
   * Create new Canvg instance with inherited options.
   * @param ctx - Rendering context.
   * @param svg - SVG source string or URL.
   * @param options - Rendering options.
   * @returns Canvg instance.
   */fork(t,e){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Canvg.from(t,e,{...this.options,...s})}
/**
   * Create new Canvg instance with inherited options.
   * @param ctx - Rendering context.
   * @param svg - SVG source string.
   * @param options - Rendering options.
   * @returns Canvg instance.
   */forkString(t,e){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Canvg.fromString(t,e,{...this.options,...s})}
/**
   * Document is ready promise.
   * @returns Ready promise.
   */ready(){return this.screen.ready()}
/**
   * Document is ready value.
   * @returns Is ready or not.
   */isReady(){return this.screen.isReady()}
/**
   * Render only first frame, ignoring animations and mouse.
   * @param options - Rendering options.
   */async render(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.start({enableRedraw:true,ignoreAnimation:true,ignoreMouse:true,...t});await this.ready();this.stop()}
/**
   * Start rendering.
   * @param options - Render options.
   */start(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{documentElement:e,screen:s,options:n}=this;s.start(e,{enableRedraw:true,...n,...t})}stop(){this.screen.stop()}
/**
   * Resize SVG to fit in given size.
   * @param width
   * @param height
   * @param preserveAspectRatio
   */resize(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this.documentElement.resize(t,e,s)}
/**
   * Main constructor.
   * @param ctx - Rendering context.
   * @param svg - SVG Document.
   * @param options - Rendering options.
   */constructor(t,e,s={}){this.parser=new Parser(s);this.screen=new Screen(t,s);this.options=s;const n=new Document(this,s);const i=n.createDocumentElement(e);this.document=n;this.documentElement=i}}export{AElement,AnimateColorElement,AnimateElement,AnimateTransformElement,BoundingBox,CB1,CB2,CB3,CB4,Canvg,CircleElement,ClipPathElement,DefsElement,DescElement,Document,Element,EllipseElement,FeColorMatrixElement,FeCompositeElement,FeDropShadowElement,FeGaussianBlurElement,FeMorphologyElement,FilterElement,Font,FontElement,FontFaceElement,GElement,GlyphElement,GradientElement,ImageElement,LineElement,LinearGradientElement,MarkerElement,MaskElement,Matrix,MissingGlyphElement,Mouse,p as PSEUDO_ZERO,Parser,PathElement,PathParser,PatternElement,Point,PolygonElement,PolylineElement,Property,QB1,QB2,QB3,RadialGradientElement,RectElement,RenderedElement,Rotate,SVGElement,SVGFontLoader,Scale,Screen,Skew,SkewX,SkewY,StopElement,StyleElement,SymbolElement,TRefElement,TSpanElement,TextElement,TextPathElement,TitleElement,Transform,Translate,UnknownElement,UseElement,ViewPort,compressSpaces,S as elements,getSelectorSpecificity,normalizeAttributeName,normalizeColor,parseExternalUrl,i as presets,toMatrixValue,toNumbers,trimLeft,trimRight,vectorMagnitude,vectorsAngle,vectorsRatio};

