<div class="fr-container">
  <div class="fr-grid-row fr-grid-row--gutters">
    <div class="fr-col-12 fr-col-lg-12">
      <h1 class="fr-mt-6w">Liste des BOP</h1>

      <div class="fr-table--lg fr-table fr-table--no-caption">
        <div class="fr-table__header">
          <p class="fr-table__detail"></p>
          <ul class="fr-btns-group fr-btns-group--right fr-btns-group--inline-md fr-btns-group--icon-left">
            <li>
              <button class="fr-btn fr-icon-search-line fr-btn--icon-left " aria-controls="filtres" aria-expanded="false">
                Rechercher
              </button>
            </li>
            <li>
              <button class="fr-btn fr-icon-download-line fr-btn--icon-left fr-btn--secondary"><%= link_to bops_path(format: :xlsx) do %>
                  Télécharger la liste
                <% end %></button>
            </li>
          </ul>
        </div>
        <div class="fr-collapse fr-collapse--grey fr-px-2w" id="filtres" data-controller="request">
          <div class="fr-h4 fr-my-2w">Rechercher un BOP</div>
          <%= search_form_for @q, url: bops_path, data: { 'request-target': 'form', turbo_frame: 'table', turbo_action: 'advance' } do |f| %>
            <div class="fr-mb-2w">
              <%= f.search_field :code_contains, class: 'fr-input', placeholder: "Rechercher un BOP", oninput: 'this.form.requestSubmit()' %>
            </div>
          <% end %>
        </div>
        <%= turbo_frame_tag :table, data: { turbo_action: 'advance' } do %>
          <div class="fr-table__wrapper">
            <div class="fr-table__container">
              <div class="fr-table__content">
                <table class="fr-cell--multiline">
                  <caption>BOP</caption>
                  <thead>
                  <tr>
                    <th scope="col">BOP</th>
                    <th scope="col">Dotation</th>
                    <th scope="col">Programme</th>
                    <th scope="col">Contrôleur</th>
                    <th scope="col">DCB responsable</th>
                  </tr>
                  </thead>

                  <tbody>
                  <% @liste_bops_page&.each do |bop| %>
                    <tr>
                      <td><%= link_to bop_path(bop.id), data: {turbo_frame: "_top"} do %><%= bop.code %>
                        <% end %></td>
                      <td>
                        <% if bop.dotation.nil? %><p class="fr-badge fr-badge--sm">non renseigné</p>
                        <% elsif bop.dotation == "aucune" %>
                          <p class="fr-badge fr-badge--sm fr-badge--pink-tuile">inactif</p>
                        <% elsif bop.dotation == "complete" %>
                          <p class="fr-badge fr-badge--sm fr-badge--purple-glycine">T2/HT2 </p>
                        <% elsif bop.dotation == "T2" %>
                          <p class="fr-badge fr-badge--sm fr-badge--yellow-tournesol">T2</p>
                        <% elsif bop.dotation == "HT2" %>
                          <p class="fr-badge fr-badge--sm fr-badge--brown-caramel">HT2</p>
                        <% end %></td>
                      <td><%= bop.numero_programme %> - <%= bop.nom_programme %></td>
                      <td><%= bop.user.nom %></td>
                      <td><%= bop.consultant.nom %></td>
                    </tr>
                  <% end %>
                  </tbody>

                </table>
              </div>
            </div>
          </div>
          <div class="fr-table__footer">
            <div class="fr-table__footer--start">
              <p class="fr-table__detail"><%= @liste_bops.length %> résultats</p>
              <div class="fr-select-group">
                <label class="fr-sr-only fr-label" for="table-footer-select-7847">
                  Nombre de lignes par page
                </label>
                <div class="fr-messages-group" id="table-footer-select-7847-messages" aria-live="polite"></div>
              </div>
            </div>
            <div class="fr-table__footer--middle">
              <%== pagy_nav_custom(@pagy) %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>