<% content_for :title do %>Restitutions | ANACO <% end %>
<main>
  <div class="fr-container">
    <div class="fr-grid-row fr-grid-row--gutters">
      <div class="fr-col-12 fr-col-lg-12">
        <div class="title-btn fr-mt-2w">
          <div></div>
          <nav role="navigation" class="fr-pagination" aria-label="Pagination">
            <ul class="fr-pagination__list">
              <li>
                <%= link_to restitutions_path(date: 2023), class: "fr-pagination__link", aria: (@annee_a_afficher == 2023 ? { current: 'page' } : {}) do %>
                  2023
                <%end %>
              </li>
              <li>
                <%= link_to restitutions_path(date: 2024), class: "fr-pagination__link",aria: (@annee_a_afficher == 2024 ? { current: 'page' } : {}) do %>
                  2024
                <%end %>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
  <div class="fr-container fr-mb-4w" data-controller="highcharts" data-highcharts-avis="<%= @avis_repartition %>" data-highcharts-avisdate="<%= @avis_date_repartition %>" data-highcharts-notesbar="<%= @notes_bar %>">
    <div class="fr-grid-row fr-grid-row--gutters">
      <div class="fr-col-12 fr-col-lg-12">
        <h1 class="fr-mt-0w fr-mb-2w">Restitutions nationales sur tous les programmes [<%= @total_programmes %>]</h1>
      </div>
    </div>
    <div class="fr-grid-row fr-grid-row--gutters">
      <div class="fr-col-12 fr-col-lg-4">
        <div data-highcharts-target="canvasAvisDate"></div>
      </div>
      <div class="fr-col-12 fr-col-lg-4">
        <div data-highcharts-target="canvasAvis"></div>
      </div>
      <div class="fr-col-12 fr-col-lg-4">
        <div data-highcharts-target="canvasNotesBar"></div>
      </div>
    </div>
    <% if current_user.statut == "admin" %>
      <h2 class="fr-mt-6w fr-mb-2w">Les programmes [<%= @programmes.length %>]</h2>
    <%else  %>
      <h2 class="fr-mt-6w fr-mb-2w">Mes programmes [<%= @programmes.length %>/<%=@total_programmes %>]</h2>
    <%end %>

    <div class="fr-grid-row fr-grid-row--gutters">
      <% @programmes.each do |numero, nom| %>
        <div class="fr-col-12 fr-col-lg-3">
          <div class="fr-card">
            <div class="fr-card__body">
              <div class="fr-card__content">
                <div class="fr-card__start">
                  <ul class="fr-badges-group">
                    <li>
                      <p class="fr-badge fr-badge--purple-glycine"><%= pluralize(@liste_avis_par_programme[numero],'avis/note rempli', plural: 'avis/notes remplis') %> </p>
                    </li>
                  </ul>
                  <p class="fr-card__detail fr-icon-arrow-right-line"><%= @liste_bops_par_programme[numero] %> BOP (<%= pluralize(@liste_bops_inactifs_par_programme[numero],'BOP inactif', plural: 'BOP inactifs')  %>)</p>
                </div>
                <h3 class="fr-card__title">Programme nÂ°<%= numero %> </h3>
                <div class="fr-card__desc"> <%= nom %></div>
              </div>
              <div class="fr-card__footer">
                <ul class="fr-links-group">
                  <li>
                    <%= link_to specific_restitutions_path(programme: numero, date: @annee_a_afficher), class: "fr-link fr-icon-arrow-right-line fr-link--icon-right" do %> Afficher <% end %>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      <%end  %>
    </div>
  </div>
</main>