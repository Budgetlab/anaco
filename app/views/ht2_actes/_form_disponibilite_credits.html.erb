<h2>Contrôle de la disponibilité des crédits</h2>
<div data-controller="acte-form">
  <%= form_with(model: @acte) do |f| %>
    <%= hidden_field_tag :etape, 3 %>
    <div class="fr-grid-row fr-grid-row--gutters">
      <div class="fr-col-12 fr-col-lg-12">
        <div class="fr-notice fr-notice--info fr-mb-2w">
          <div class="fr-container">
            <div class="fr-notice__body">
              <p>
                <span class="fr-notice__title"></span>
              <span class="fr-notice__desc">
                Le système d’information Chorus permet d’apprécier en temps réel et de manière automatique la disponibilité des crédits en AE sur le centre financier permettant d’engager la dépense. <br>Le contrôle de la disponibilité des crédits opéré par le contrôleur doit cibler :<br><br>
• une éventuelle concomitance de demandes d’achat en cours de traitement (non encore comptabilisées dans le SI)  et pouvant conduire à une indisponibilité de crédits;<br>
• la prise en compte d’éléments de contexte externe concernant l’évolution de la ressource du programme (mouvement en cours ou à venir à l’instar de décret de virement/transfert, annulation, avance, LFR, LFG, perception de FDC, ADP, RDC). A cet égard, une attention particulière doit être portée pendant la période de fin de gestion où le schéma de fin de gestion peut avoir un impact direct sur le niveau de la ressource. Des échanges entre CBR/DCB, avec le RFFIM et le BS peuvent contribuer à apprécier ces éléments de contexte de la manière la plus juste et la plus à jour;<br>
• le suivi des délégations de crédits fléchées (en particulier en BOP déconcentrés) par rapport aux dépenses à financer;<br>
• la disponibilité des CP nécessaires au paiement lorsque le SF sera certifié dans l’année.
              </span>
              </p>
            </div>
          </div>
        </div>
        <fieldset class="fr-fieldset fr-mb-3w">
          <legend class="fr-fieldset__legend--regular fr-fieldset__legend fr-mb-1w" id='radio-inline-legend'>
            Le critère est-il validé?*
          </legend>
          <div class="fr-fieldset__element fr-fieldset__element--inline fr-mb-0">
            <div class="fr-radio-group">
              <%= f.radio_button :disponibilite_credits, true, id: "radio-true", checked: @acte.disponibilite_credits.nil? || @acte.disponibilite_credits == true, data: { action: "change->acte-form#toggleMessage" } %>
              <label class="fr-label" for="radio-true">Oui</label>
            </div>
          </div>
          <div class="fr-fieldset__element fr-fieldset__element--inline fr-mb-0">
            <div class="fr-radio-group">
              <%= f.radio_button :disponibilite_credits, false, checked: @acte.disponibilite_credits == false, id: "radio-false", data: { action: "change->acte-form#toggleMessage" } %>
              <label class="fr-label" for="radio-false">Non</label>
            </div>
          </div>
        </fieldset>

        <div class="fr-alert fr-alert--info fr-mb-3w" style="<%= @acte.disponibilite_credits == false ? '' : 'display: none;' %>" data-acte-form-target="message">
          <p>L'ajout d'une suspension est possible à l'étape 6.</p>
        </div>

        <div class="fr-input-group" data-controller="trix">
          <label for="commentaire_disponibilite_credits" class="fr-label">Observations et pièce justificative
            <span class="fr-hint-text">Pour les pièces justificatives, seules les images, captures d'écran sont autorisées.</span>
          </label>
          <%= f.rich_text_area :commentaire_disponibilite_credits, direct_upload: true, class: 'trix-content-form' %>
        </div>
      </div>
    </div>
    <div class="fr-grid-row fr-grid-row--gutters">
      <div class="fr-col-12 fr-col-lg-12 fr-my-2w">
        <ul class="fr-btns-group fr-btns-group--icon-left fr-btns-group--inline fr-btns-group--right">
          <li><%= f.submit "Valider et passer à l'étape suivante", class: 'fr-btn' %></li>
        </ul>
      </div>
    </div>
  <% end %>
</div>